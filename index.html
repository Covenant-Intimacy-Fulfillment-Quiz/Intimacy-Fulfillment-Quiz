<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Marriage Connection Quiz</title>

  <!-- Required libraries -->
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    body { 
      font-family: Arial, sans-serif; 
      background: #FFF9F2; 
      color: #1a3c5e; 
      max-width: 900px; 
      margin: auto; 
      padding: 20px; 
      box-sizing: border-box; 
    }
    h1, h2, h3 { text-align: center; line-height: 1.3; }
    .card { 
      background: #FFFFFF; 
      border: 2px solid #4d9de0; 
      border-radius: 12px; 
      padding: 25px; 
      box-shadow: 0 8px 25px rgba(0,0,0,0.08); 
      margin: 20px auto; 
      max-width: 750px; 
      text-align: center; 
      line-height: 1.3; 
    }
    .btn, .answer-btn { 
      background: #4d9de0; 
      color: white; 
      font-weight: bold; 
      border: none; 
      border-radius: 8px; 
      padding: 15px 25px; 
      cursor: pointer; 
      margin: 12px auto; 
      display: block; 
      width: 100%; 
      max-width: 500px; 
      text-align: center; 
      touch-action: manipulation; 
    }
    .btn:hover, .answer-btn:hover { background: #3a7fbf; }
    .answer-btn.selected { 
      background: #3a7fbf; 
      transform: scale(0.98); 
      transition: all 0.2s ease; 
    }
    #backBtn { 
      padding: 8px 15px; 
      max-width: 120px; 
      font-size: 0.9rem; 
      line-height: 1; 
    }
    .hidden { display: none; }
    .progress-bar-container { 
      width: 100%; 
      max-width: 500px; 
      height: 10px; 
      background: #E0E0E0; 
      border-radius: 5px; 
      margin: 10px auto; 
    }
    .progress-bar { 
      height: 100%; 
      background: #FF4D4D; 
      border-radius: 5px; 
      transition: width 0.3s ease; 
    }
    .result-block { 
      margin: 15px 0; 
      text-align: left; 
      padding: 20px; 
      border-radius: 8px; 
      border-left: 8px solid; 
      line-height: 1.3; 
    }
    .logo { 
      display: block; 
      margin: 0 auto 15px auto; 
      max-width: 200px; 
    }
    .question-box { 
      background: #FFFFFF; 
      border: 1px solid #4d9de0; 
      border-radius: 8px; 
      padding: 20px; 
      margin: 15px auto; 
      max-width: 700px; 
    }
    .sr-only { 
      position: absolute; 
      width: 1px; 
      height: 1px; 
      padding: 0; 
      margin: -1px; 
      overflow: hidden; 
      clip: rect(0, 0, 0, 0); 
      border: 0; 
    }
    .error { 
      color: red; 
      font-size: 0.8rem; 
      display: none; 
      margin: 5px 0; 
    }
    .intro-text { 
      font-size: 1rem; 
      line-height: 1.3; 
      margin: 20px 0; 
      text-align: left; 
    }
    .action-tip { 
      font-style: italic; 
      color: #3a7fbf; 
      margin-top: 5px; 
      line-height: 1.3; 
    }
    .note { 
      font-style: italic; 
      margin-top: 10px; 
      margin-left: 20px; 
      line-height: 1.3; 
    }
    .results-list { 
      list-style-position: outside; 
      margin-left: 10px; 
      text-indent: 6px; 
      line-height: 1.3; 
    }
    .results-list li { margin-bottom: 8px; }
    .left-align { text-align: left; }

    @media (max-width: 600px) {
      body { padding: 10px; }
      .card { max-width: 100%; padding: 15px; }
      .btn, .answer-btn { max-width: 100%; padding: 10px 15px; font-size: 0.9rem; }
      .progress-bar-container { max-width: 100%; }
      .question-box { max-width: 100%; }
      .logo { max-width: 150px; }
    }
  </style>
</head>
<body>

<!-- Intro Page -->
<div id="introPage" class="card" style="text-align:center;">
  <img src="https://static.wixstatic.com/media/4d6372_c110ccf05896482192f466d6c0e3c1ae~mv2.png/v1/fill/w_476,h_194,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/Untitled-28_edited.png" class="logo" alt="Logo" onerror="this.src='https://via.placeholder.com/200x80?text=Logo'"/>
  <h1>Ready to Unlock Your Marriage Connection Profile?</h1>
  <p>It’s quick, insightful, and fun! In just a few minutes, you’ll discover how you naturally express affection, what helps you feel most loved, and the key intimacy areas that matter most to you and your spouse.</p>
  <div style="display:flex; justify-content:center;">
    <button id="startQuizBtn" class="btn" style="max-width:250px;">Start My Assessment</button>
  </div>
  <p style="color:#A3A3A3; font-size:0.9rem; margin-top:10px;">HappyMarriageHappyLife.com</p>
</div>

<!-- Quiz Page -->
<div id="quizPage" class="card hidden">
  <h2>Intimacy Profile Assessment</h2>
  <div class="progress-bar-container"><div class="progress-bar" id="progressBar"></div></div>
  <div class="progress" id="progress"></div>
  <div class="question-box" id="questionContainer" role="radiogroup"></div>
  <button class="btn" onclick="goBack()" id="backBtn" style="display: none;">Previous Question</button>
  <p style="color:#A3A3A3; font-size:0.9rem; margin-top:10px;">HappyMarriageHappyLife.com</p>
</div>

<!-- Result Page -->
<div id="resultPage" class="card hidden">
  <img src="https://static.wixstatic.com/media/4d6372_c110ccf05896482192f466d6c0e3c1ae~mv2.png/v1/fill/w_476,h_194,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/Untitled-28_edited.png" class="logo" alt="Logo" onerror="this.src='https://via.placeholder.com/200x80?text=Logo'"/>
  <h2>Your Personalized Connection Profile</h2>
  <div id="results"></div>
  <div class="email-form">
    <input type="text" id="nameInput" placeholder="Your Name" required/>
    <span id="nameError" class="error">Please enter your name</span>
    <input type="email" id="emailInput" placeholder="Your Email" required/>
    <span id="emailError" class="error">Please enter a valid email</span>
    <button class="btn" onclick="validateAndSend()">Send & Download PDF</button>
  </div>
</div>

<script>
/* Intimacy Descriptions and Tips */
const intimacyDescriptions = {
  Spiritual: { desc: "Shared faith and values form the foundation of your bond.", tip: "Share a daily prayer or discuss your faith to deepen your spiritual bond." },
  Emotional: { desc: "You long to feel emotionally safe and deeply known.", tip: "Set aside time each week for a heartfelt conversation to feel truly known." },
  Commitment: { desc: "You thrive when trust and covenant loyalty feel secure.", tip: "Reinforce trust by consistently honoring promises and shared goals." },
  Intellectual: { desc: "You enjoy connecting through thoughtful conversations.", tip: "Engage in thoughtful discussions or read a book together to connect mentally." },
  Affable: { desc: "Playfulness, kindness, and joy build your connection.", tip: "Plan playful moments or share jokes to keep your connection light and joyful." },
  Recreational: { desc: "Fun and shared activities strengthen your bond.", tip: "Schedule a fun activity, like a hike or game night, to strengthen your bond." },
  Partnership: { desc: "You value teamwork and shared decision-making.", tip: "Collaborate on a household project to build teamwork and unity." },
  Financial: { desc: "Transparency with money strengthens trust and unity.", tip: "Review your budget together monthly to foster trust and transparency." },
  Creative: { desc: "Collaborating on ideas or projects brings you closer.", tip: "Work on a creative project, like cooking or crafting, to spark shared joy." },
  Conflict: { desc: "Respectful resolution of disagreements deepens intimacy.", tip: "Practice respectful listening during disagreements to deepen intimacy." },
  Physical: { desc: "Being close through touch helps you feel safe and loved.", tip: "Incorporate small gestures like holding hands to feel closer through touch." },
  Sexual: { desc: "Sexual intimacy expresses affection, passion, and closeness.", tip: "Communicate openly about desires to nurture passion and closeness." }
};

/* Color Palettes */
const typeColors = {
  Spiritual: "#6A4C93", Emotional: "#FF7A70", Commitment: "#FFB347",
  Intellectual: "#4C6B9B", Affable: "#FFB6C1", Recreational: "#4DD2FF",
  Partnership: "#3CB371", Financial: "#FFD700", Creative: "#FF66CC",
  Conflict: "#FFA552", Physical: "#FF8C69", Sexual: "#E63946",
  SanguineExpress: "#FFB347", SanguineReceive: "#FFD580",
  MelancholyExpress: "#6A4C93", MelancholyReceive: "#A68CC2",
  SupineExpress: "#88C0D0", SupineReceive: "#B2DFDB",
  PhlegmaticExpress: "#4CAF50", PhlegmaticReceive: "#A3D977",
  CholericExpress: "#E63946", CholericReceive: "#FF7A70",
  SteadyConnector: "#4CAF50", ReassuranceSeeker: "#FFADAD",
  IndependentConnector: "#88C0D0", GuardedConnector: "#A5A5A5"
};

const typeColorsWithOpacity = {
  Spiritual: "rgba(106, 76, 147, 0.08)", Emotional: "rgba(255, 122, 112, 0.08)", Commitment: "rgba(255, 179, 71, 0.08)",
  Intellectual: "rgba(76, 107, 155, 0.08)", Affable: "rgba(255, 182, 193, 0.08)", Recreational: "rgba(77, 210, 255, 0.08)",
  Partnership: "rgba(60, 179, 113, 0.08)", Financial: "rgba(255, 215, 0, 0.08)", Creative: "rgba(255, 102, 204, 0.08)",
  Conflict: "rgba(255, 165, 82, 0.08)", Physical: "rgba(255, 140, 105, 0.08)", Sexual: "rgba(230, 57, 70, 0.08)",
  SanguineExpress: "rgba(255, 179, 71, 0.08)", SanguineReceive: "rgba(255, 213, 128, 0.08)",
  MelancholyExpress: "rgba(106, 76, 147, 0.08)", MelancholyReceive: "rgba(166, 140, 194, 0.08)",
  SupineExpress: "rgba(136, 192, 208, 0.08)", SupineReceive: "rgba(178, 223, 219, 0.08)",
  PhlegmaticExpress: "rgba(76, 175, 80, 0.08)", PhlegmaticReceive: "rgba(163, 217, 119, 0.08)",
  CholericExpress: "rgba(230, 57, 70, 0.08)", CholericReceive: "rgba(255, 122, 112, 0.08)",
  SteadyConnector: "rgba(76, 175, 80, 0.08)", ReassuranceSeeker: "rgba(255, 173, 173, 0.08)",
  IndependentConnector: "rgba(136, 192, 208, 0.08)", GuardedConnector: "rgba(165, 165, 165, 0.08)"
};

/* Bonding Insights */
const bondingInsights = {
  SteadyConnector: { 
    desc: "Your ability to communicate openly and reconnect quickly strengthens your marriage. You create a safe space for honest dialogue, fostering resilience and mutual understanding. Your strength lies in maintaining a stable, communicative bond that thrives through challenges.", 
    challenges: "You may occasionally overlook your spouse’s need for space or deeper reassurance, assuming quick communication resolves all issues.", 
    tip: "Schedule a weekly check-in to discuss feelings openly and ensure your spouse feels heard." 
  },
  ReassuranceSeeker: { 
    desc: "You thrive on frequent reassurance, creating emotional security that strengthens your connection. Your need for affirmation helps your marriage stay emotionally vibrant, especially during tough times.", 
    challenges: "Your desire for constant reassurance may feel overwhelming to a spouse who expresses love differently.", 
    tip: "Ask your spouse for a daily affirmation, like a kind word or gesture, to feel secure and loved." 
  },
  IndependentConnector: { 
    desc: "Your preference for calm, steady connection creates stability. Your peaceful presence helps your spouse feel grounded, promoting a nurturing environment for your marriage to flourish.", 
    challenges: "Your need for space may be mistaken for emotional distance, potentially leaving your spouse feeling disconnected.", 
    tip: "Plan a quiet evening together each week to foster calm, steady connection without pressure." 
  },
  GuardedConnector: { 
    desc: "Building trust over time is key for you, ensuring a deep, dependable bond. Your cautious approach strengthens your marriage by fostering loyalty and commitment.", 
    challenges: "Your guarded nature may slow emotional intimacy, making it harder to open up during conflicts.", 
    tip: "Create a small ritual, like a daily promise or gesture, to build trust with your spouse over time." 
  }
};

  /* Questions Array 1 - 53 */
const questions = [
  // 1–10
  {
    q: "When your spouse is feeling stressed, what's your natural first instinct?",
    opts: [
      { text: "I try to lighten the mood with a joke or some fun distraction.", t: "Sanguine", i: "Recreational" },
      { text: "I take charge and jump into action to solve the problem.", t: "Choleric", i: "Conflict" },
      { text: "I offer thoughtful advice or try to talk through the deeper issue.", t: "Melancholy", i: "Intellectual" },
      { text: "I sit with them, listen quietly, and offer a comforting presence.", t: "Phlegmatic", i: "Affable" },
      { text: "I quietly find ways to help them without even being asked.", t: "Supine", i: "Partnership" }
    ]
  },
  {
    q: "It's a free weekend! What sounds like the perfect plan for you?",
    opts: [
      { text: "Doing something spontaneous and exciting, whatever comes to mind!", t: "Sanguine", i: "Recreational" },
      { text: "Tackling a project or making progress on a personal goal.", t: "Choleric", i: "Partnership" },
      { text: "Reading a good book, thinking deeply, or working on a creative project.", t: "Melancholy", i: "Creative" },
      { text: "Relaxing at home with family and enjoying a quiet day.", t: "Phlegmatic", i: "Affable" },
      { text: "Lending a hand to help someone or serving the family in some way.", t: "Supine", i: "Commitment" }
    ]
  },
  {
    q: "If your spouse is sad, how do you tend to respond?",
    opts: [
      { text: "I try my best to make them smile or laugh.", t: "Sanguine", i: "Recreational" },
      { text: "I want to fix whatever is causing their sadness.", t: "Choleric", i: "Conflict" },
      { text: "I offer to have a deep, meaningful conversation about it.", t: "Melancholy", i: "Intellectual" },
      { text: "I give them a hug and comfort them with my physical presence.", t: "Phlegmatic", i: "Physical" },
      { text: "I perform a kind, helpful act to show I care.", t: "Supine", i: "Partnership" }
    ]
  },
  {
    q: "In a group setting, what is your go-to role?",
    opts: [
      { text: "I'm the one talking, joking, and engaging everyone in conversation.", t: "Sanguine", i: "Recreational" },
      { text: "I tend to take the lead or organize what the group should do.", t: "Choleric", i: "Conflict" },
      { text: "I usually listen intently and observe everything around me.", t: "Melancholy", i: "Intellectual" },
      { text: "I stay relaxed and am happy to follow whatever the group decides.", t: "Phlegmatic", i: "Affable" },
      { text: "I quietly make sure everyone else feels comfortable and supported.", t: "Supine", i: "Partnership" }
    ]
  },
  {
    q: "What does your ideal date night look like?",
    opts: [
      { text: "Something new, fun, or completely spontaneous.", t: "Sanguine", i: "Recreational" },
      { text: "Something productive, like working toward a shared goal or project.", t: "Choleric", i: "Commitment" },
      { text: "A quiet evening with a deep, meaningful activity or conversation.", t: "Melancholy", i: "Creative" },
      { text: "A low-key, comfortable night in with no pressure.", t: "Phlegmatic", i: "Affable" },
      { text: "An evening centered around doing something that serves or honors my spouse.", t: "Supine", i: "Partnership" }
    ]
  },
  {
    q: "How do you typically approach making a decision?",
    opts: [
      { text: "I go with what feels the most fun in the moment.", t: "Sanguine", i: "Emotional" },
      { text: "I make a quick decision and take control of the situation.", t: "Choleric", i: "Conflict" },
      { text: "I think through all the possible details and consequences first.", t: "Melancholy", i: "Intellectual" },
      { text: "I go with the flow to keep the peace.", t: "Phlegmatic", i: "Affable" },
      { text: "I first ask what other people want to do.", t: "Supine", i: "Commitment" }
    ]
  },
  {
    q: "During a conflict, what is your most common reaction?",
    opts: [
      { text: "I try to crack a joke or use humor to diffuse the tension.", t: "Sanguine", i: "Emotional" },
      { text: "I push hard to get to a resolution and find a solution.", t: "Choleric", i: "Conflict" },
      { text: "I retreat to think about everything before I say anything.", t: "Melancholy", i: "Intellectual" },
      { text: "I stay calm and make an effort to avoid escalating the argument.", t: "Phlegmatic", i: "Affable" },
      { text: "I try to concede or please the other person to end the conflict.", t: "Supine", i: "Commitment" }
    ]
  },
  {
    q: "How do you most naturally express affection to your spouse?",
    opts: [
      { text: "With playful words, big smiles, and lots of excitement.", t: "Sanguine", i: "Emotional" },
      { text: "By doing things for them or accomplishing tasks to help.", t: "Choleric", i: "Partnership" },
      { text: "Through meaningful conversations or writing heartfelt notes.", t: "Melancholy", i: "Creative" },
      { text: "With physical touch, like a hug, or just being quietly present.", t: "Phlegmatic", i: "Physical" },
      { text: "By serving them or making a small sacrifice without mentioning it.", t: "Supine", i: "Partnership" }
    ]
  },
  {
    q: "If you suddenly found yourself with an extra hour in your day, how would you spend it?",
    opts: [
      { text: "Planning a fun and unexpected activity.", t: "Sanguine", i: "Recreational" },
      { text: "Using the time to get something important accomplished.", t: "Choleric", i: "Partnership" },
      { text: "Working on a personal hobby or a creative project I've been thinking about.", t: "Melancholy", i: "Creative" },
      { text: "Taking the chance to relax or maybe even nap.", t: "Phlegmatic", i: "Affable" },
      { text: "Finding a way to help my spouse or family with something they need.", t: "Supine", i: "Partnership" }
    ]
  },
  {
    q: "When your spouse forgets to thank you for something you did, how do you feel?",
    opts: [
      { text: "I laugh it off; it’s no big deal.", t: "Sanguine", i: "Emotional" },
      { text: "I'm likely to remind them of the effort I put in.", t: "Choleric", i: "Commitment" },
      { text: "I feel a bit overlooked but reflect on why it happened.", t: "Melancholy", i: "Intellectual" },
      { text: "I assume they didn't mean anything by it and let it go.", t: "Phlegmatic", i: "Affable" },
      { text: "I feel unappreciated and a little hurt, like they don’t see my efforts.", t: "Supine", i: "Commitment" }
    ]
  },

  // 11–20
  {
    q: "When you're needing encouragement, what kind of support feels most meaningful to you?",
    opts: [
      { text: "Something fun to lift my spirits and help me laugh again.", t: "Sanguine", i: "Recreational" },
      { text: "A reminder of my goals and someone helping me get back on track.", t: "Choleric", i: "Commitment" },
      { text: "Deep words of affirmation that show they truly understand me.", t: "Melancholy", i: "Emotional" },
      { text: "A quiet gesture of presence or physical reassurance.", t: "Phlegmatic", i: "Physical" },
      { text: "Someone noticing my needs and helping me without me even asking for it.", t: "Supine", i: "Partnership" }
    ]
  },
  {
    q: "How do you typically respond when your spouse has a need?",
    opts: [
      { text: "I bring fun or distraction to brighten their mood.", t: "Sanguine", i: "Emotional" },
      { text: "I take charge and help them find a solution quickly.", t: "Choleric", i: "Conflict" },
      { text: "I try to deeply understand and offer meaningful support.", t: "Melancholy", i: "Emotional" },
      { text: "I stay close and give them space if that's what they need.", t: "Phlegmatic", i: "Affable" },
      { text: "I try to anticipate their needs and offer help behind the scenes.", t: "Supine", i: "Partnership" }
    ]
  },
  {
    q: "Your spouse wants to try something new. What's your immediate response?",
    opts: [
      { text: "I'm instantly excited and ready to jump in and try it!", t: "Sanguine", i: "Emotional" },
      { text: "I evaluate how it aligns with our shared goals first.", t: "Choleric", i: "Commitment" },
      { text: "I want to understand the deeper meaning or reason behind it.", t: "Melancholy", i: "Intellectual" },
      { text: "I'll go along if it feels peaceful and won't cause any disruption.", t: "Phlegmatic", i: "Affable" },
      { text: "I wait for them to take the lead, then quietly follow along.", t: "Supine", i: "Commitment" }
    ]
  },
  {
    q: "Which kind of compliment truly means the most to you?",
    opts: [
      { text: "'You’re so fun and make everything more enjoyable!'", t: "Sanguine", i: "Emotional" },
      { text: "'You always get things done and keep us moving forward.'", t: "Choleric", i: "Partnership" },
      { text: "'You’re so thoughtful and deep—your insight really moves me.'", t: "Melancholy", i: "Creative" },
      { text: "'You're so calm and easy to be around—I feel safe with you.'", t: "Phlegmatic", i: "Affable" },
      { text: "'You're so loyal and sacrificial—you love deeply without needing recognition.'", t: "Supine", i: "Commitment" }
    ]
  },
  {
    q: "During a busy season, what keeps you feeling connected to your spouse?",
    opts: [
      { text: "Little moments of fun and laughter together.", t: "Sanguine", i: "Emotional" },
      { text: "When we’re working as a team and checking off goals.", t: "Choleric", i: "Partnership" },
      { text: "Knowing they are thinking of me and sharing meaningful thoughts.", t: "Melancholy", i: "Emotional" },
      { text: "Physical closeness and gentle reassurance.", t: "Phlegmatic", i: "Physical" },
      { text: "When they show care in small, behind-the-scenes ways.", t: "Supine", i: "Partnership" }
    ]
  },
  {
    q: "What kind of date night would help you feel most loved right now?",
    opts: [
      { text: "Something spontaneous and exciting!", t: "Sanguine", i: "Recreational" },
      { text: "Working on a shared goal or project together.", t: "Choleric", i: "Partnership" },
      { text: "A heart-to-heart conversation over dinner.", t: "Melancholy", i: "Intellectual" },
      { text: "Just sitting close and relaxing with no pressure.", t: "Phlegmatic", i: "Physical" },
      { text: "Doing something that shows they were thinking of me without being asked.", t: "Supine", i: "Partnership" }
    ]
  },
  {
    q: "What's your biggest strength when it comes to connecting with others?",
    opts: [
      { text: "Creating fun and making memories together.", t: "Sanguine", i: "Emotional" },
      { text: "Getting things done and showing love through actions.", t: "Choleric", i: "Partnership" },
      { text: "Offering deep understanding and emotional insight.", t: "Melancholy", i: "Emotional" },
      { text: "Being calm, peaceful, and emotionally steady.", t: "Phlegmatic", i: "Physical" },
      { text: "Serving faithfully and consistently, even when it's unnoticed.", t: "Supine", i: "Commitment" }
    ]
  },
  {
    q: "What drains you the most in your relationship?",
    opts: [
      { text: "Boredom and a routine with no spontaneity.", t: "Sanguine", i: "Recreational" },
      { text: "Lack of progress or feeling stuck in disorganization.", t: "Choleric", i: "Conflict" },
      { text: "Surface-level talk with no emotional depth.", t: "Melancholy", i: "Emotional" },
      { text: "Too much conflict or emotional pressure.", t: "Phlegmatic", i: "Affable" },
      { text: "Feeling unseen, unappreciated, or taken for granted.", t: "Supine", i: "Commitment" }
    ]
  },
  {
    q: "What’s one simple thing your spouse could do to instantly connect with you?",
    opts: [
      { text: "Do something fun and unexpected with me.", t: "Sanguine", i: "Recreational" },
      { text: "Help me with a project or take initiative with something important.", t: "Choleric", i: "Partnership" },
      { text: "Share something vulnerable or emotionally meaningful.", t: "Melancholy", i: "Emotional" },
      { text: "Offer gentle affection or quality time with no pressure.", t: "Phlegmatic", i: "Physical" },
      { text: "Notice and appreciate the small things I’ve done.", t: "Supine", i: "Commitment" }
    ]
  },
  {
    q: "What makes you feel most disconnected in your marriage?",
    opts: [
      { text: "A lack of shared joy or spontaneity.", t: "Sanguine", i: "Recreational" },
      { text: "Feeling like things aren’t getting done or we’re drifting off course.", t: "Choleric", i: "Partnership" },
      { text: "When we stop having meaningful or deep conversations.", t: "Melancholy", i: "Emotional" },
      { text: "Feeling emotionally overwhelmed or pushed to change.", t: "Phlegmatic", i: "Affable" },
      { text: "Feeling ignored, overlooked, or that my efforts don’t matter.", t: "Supine", i: "Commitment" }
    ]
  },

  // 21–30
  {
    q: "After a long day, how do you typically initiate a connection with your spouse?",
    opts: [
      { text: "I crack a joke or share a fun story to lighten the mood.", t: "Sanguine", i: "Recreational" },
      { text: "I check in about what needs to get done or how their day went.", t: "Choleric", i: "Partnership" },
      { text: "I ask meaningful questions or share something reflective.", t: "Melancholy", i: "Intellectual" },
      { text: "I sit near them or give them a quiet hug.", t: "Phlegmatic", i: "Physical" },
      { text: "I notice what they need and quietly help without calling attention to it.", t: "Supine", i: "Partnership" }
    ]
  },
  {
    q: "When you're feeling overwhelmed, what do you most hope your spouse will do?",
    opts: [
      { text: "Give me a hug, make me laugh, or do something fun to reset.", t: "Sanguine", i: "Emotional" },
      { text: "Step in and take something off my plate.", t: "Choleric", i: "Partnership" },
      { text: "Listen to my deeper feelings and help me process them.", t: "Melancholy", i: "Emotional" },
      { text: "Just be with me without needing to fix it.", t: "Phlegmatic", i: "Affable" },
      { text: "Quietly meet my needs before I even ask.", t: "Supine", i: "Commitment" }
    ]
  },
  {
    q: "How do you most naturally express appreciation to your spouse?",
    opts: [
      { text: "With excitement, physical touch, compliments, or playful energy.", t: "Sanguine", i: "Emotional" },
      { text: "By doing something productive for them.", t: "Choleric", i: "Partnership" },
      { text: "Through a service or practical task for them.", t: "Melancholy", i: "Creative" },
      { text: "A warm gesture like a hug or sharing quiet time.", t: "Phlegmatic", i: "Physical" },
      { text: "Through a quiet act of service or loyalty.", t: "Supine", i: "Commitment" }
    ]
  },
  {
    q: "What kind of connection do you crave most when life feels chaotic?",
    opts: [
      { text: "Laughter and light-hearted fun together.", t: "Sanguine", i: "Recreational" },
      { text: "Feeling like we’re still working toward our goals as a team.", t: "Choleric", i: "Partnership" },
      { text: "Problem-solving, emotional depth, and a meaningful conversation.", t: "Melancholy", i: "Intellectual" },
      { text: "A peaceful presence with no demands or expectations.", t: "Phlegmatic", i: "Affable" },
      { text: "Knowing they notice and care for me without being asked.", t: "Supine", i: "Partnership" }
    ]
  },
  {
    q: "What do you most want your spouse to understand about how you show love?",
    opts: [
      { text: "I love through joy and making life more fun.", t: "Sanguine", i: "Recreational" },
      { text: "I show love by helping us move forward and meet goals.", t: "Choleric", i: "Partnership" },
      { text: "My love runs deep even when I don't always show it.", t: "Melancholy", i: "Emotional" },
      { text: "My love is steady and always there.", t: "Phlegmatic", i: "Physical" },
      { text: "I love by serving and sacrificing, even if no one notices.", t: "Supine", i: "Commitment" }
    ]
  },
  {
    q: "When do you feel most connected with your spouse?",
    opts: [
      { text: "When we’re laughing and enjoying something fun together.", t: "Sanguine", i: "Recreational" },
      { text: "When we’re making progress on something together.", t: "Choleric", i: "Partnership" },
      { text: "When we’re having a heartfelt or meaningful conversation.", t: "Melancholy", i: "Emotional" },
      { text: "When we’re sharing physical closeness in a quiet moment.", t: "Phlegmatic", i: "Physical" },
      { text: "When they’re quietly doing something to care for me.", t: "Supine", i: "Commitment" }
    ]
  },
  {
    q: "What's your response when your spouse forgets something important to you?",
    opts: [
      { text: "I impulsively share my feelings.", t: "Sanguine", i: "Emotional" },
      { text: "I might get frustrated and remind them why it mattered.", t: "Choleric", i: "Conflict" },
      { text: "I take it personally and wonder if they truly know me.", t: "Melancholy", i: "Emotional" },
      { text: "I try not to let it bother me and stay calm.", t: "Phlegmatic", i: "Affable" },
      { text: "I feel hurt but probably won’t say anything.", t: "Supine", i: "Commitment" }
    ]
  },
  {
    q: "Which of these best describes your idea of comfort from your spouse?",
    opts: [
      { text: "They give me a big hug and do something fun or spontaneous to lift my mood.", t: "Sanguine", i: "Recreational" },
      { text: "They jump in and take care of what’s overwhelming me.", t: "Choleric", i: "Partnership" },
      { text: "They speak into my heart with understanding and care.", t: "Melancholy", i: "Emotional" },
      { text: "They sit beside me or hold me quietly.", t: "Phlegmatic", i: "Physical" },
      { text: "They notice what I need and serve me with tenderness.", t: "Supine", i: "Commitment" }
    ]
  },
  {
    q: "How do you feel when your spouse makes a big decision without you?",
    opts: [
      { text: "A little hurt, but I try to stay light-hearted about it.", t: "Sanguine", i: "Emotional" },
      { text: "Frustrated—I want to be involved in decisions.", t: "Choleric", i: "Conflict" },
      { text: "Disconnected—it makes me question how close we are.", t: "Melancholy", i: "Intellectual" },
      { text: "Resigned—I don’t like conflict and let it go.", t: "Phlegmatic", i: "Affable" },
      { text: "Unimportant—it confirms the feeling that my input doesn’t matter.", t: "Supine", i: "Commitment" }
    ]
  },
  {
    q: "Which of these is most life-giving to you in your relationship?",
    opts: [
      { text: "Shared laughter and playful moments.", t: "Sanguine", i: "Recreational" },
      { text: "Working together on meaningful goals.", t: "Choleric", i: "Partnership" },
      { text: "Being respected, known, and understood.", t: "Melancholy", i: "Emotional" },
      { text: "Having calm, comforting closeness.", t: "Phlegmatic", i: "Affable" },
      { text: "Feeling seen and appreciated for my loyalty and efforts.", t: "Supine", i: "Commitment" }
    ]
  },

  // 31–39
  {
    q: "How do you typically initiate affection with your spouse?",
    opts: [
      { text: "With playful physical affection, fun surprises, or teasing words.", t: "Sanguine", i: "Sexual" },
      { text: "By doing something helpful or taking initiative to get things done.", t: "Choleric", i: "Partnership" },
      { text: "Through heartfelt words or by seeking a moment of deep connection.", t: "Melancholy", i: "Emotional" },
      { text: "With a gentle presence, a hug, or a kind, thoughtful act.", t: "Phlegmatic", i: "Physical" },
      { text: "By quietly doing something sacrificial and thoughtful for them.", t: "Supine", i: "Commitment" }
    ]
  },
  {
    q: "When you’re sharing something vulnerable, which response from your spouse feels most validating?",
    opts: [
      { text: "They smile, lighten the mood, or enthusiastically affirm me.", t: "Sanguine", i: "Emotional" },
      { text: "They listen and then help me fix the issue or clarify what to do next.", t: "Choleric", i: "Conflict" },
      { text: "They ask follow-up questions and truly reflect on what I shared.", t: "Melancholy", i: "Intellectual" },
      { text: "They nod, stay present, and give a warm gesture like a touch or hug.", t: "Phlegmatic", i: "Physical" },
      { text: "They quietly hold space for me and later show they remembered it.", t: "Supine", i: "Commitment" }
    ]
  },
  {
    q: "What makes you feel most affirmed and valued as a spouse?",
    opts: [
      { text: "Knowing I bring joy and make things lighter and more fun.", t: "Sanguine", i: "Affable" },
      { text: "Seeing our goals move forward because of my effort.", t: "Choleric", i: "Partnership" },
      { text: "Being seen for my depth, wisdom, or creativity.", t: "Melancholy", i: "Creative" },
      { text: "Being appreciated for my steady love and calming presence.", t: "Phlegmatic", i: "Physical" },
      { text: "When they recognize how deeply I care, even when I’m quiet.", t: "Supine", i: "Commitment" }
    ]
  },
  {
    q: "How do you feel most loved during a conflict?",
    opts: [
      { text: "When they don’t lose the lightness or hope in the moment.", t: "Sanguine", i: "Emotional" },
      { text: "When they stay direct but respectful and work toward a solution.", t: "Choleric", i: "Conflict" },
      { text: "When they try to understand what’s beneath the surface.", t: "Melancholy", i: "Emotional" },
      { text: "When they stay calm and don’t pressure me.", t: "Phlegmatic", i: "Affable" },
      { text: "When they notice I’m overwhelmed and don’t demand more from me.", t: "Supine", i: "Commitment" }
    ]
  },
  {
    q: "Which scenario best describes your ideal end to a long day?",
    opts: [
      { text: "Laughing in bed or watching something fun together.", t: "Sanguine", i: "Recreational" },
      { text: "Catching up on tasks or discussing the next day’s goals.", t: "Choleric", i: "Partnership" },
      { text: "Talking deeply about something meaningful.", t: "Melancholy", i: "Intellectual" },
      { text: "Snuggling in silence or holding hands before sleep.", t: "Phlegmatic", i: "Physical" },
      { text: "Realizing they took care of something so I could rest.", t: "Supine", i: "Commitment" }
    ]
  },
  {
    q: "What type of intimacy do you often long for but rarely ask for?",
    opts: [
      { text: "Playful physical touch or spontaneous moments.", t: "Sanguine", i: "Sexual" },
      { text: "Help and initiative in shared responsibilities.", t: "Choleric", i: "Partnership" },
      { text: "Emotional insight and a meaningful conversation.", t: "Melancholy", i: "Emotional" },
      { text: "Peaceful presence and gentle connection.", t: "Phlegmatic", i: "Physical" },
      { text: "Affirmation through selfless acts and service.", t: "Supine", i: "Commitment" }
    ]
  },
  {
    q: "What makes you feel safest in your marriage?",
    opts: [
      { text: "Knowing we can laugh, flirt, and enjoy each other.", t: "Sanguine", i: "Sexual" },
      { text: "Trusting that my spouse is reliable and takes initiative.", t: "Choleric", i: "Partnership" },
      { text: "Feeling emotionally seen and deeply understood.", t: "Melancholy", i: "Emotional" },
      { text: "Knowing I won’t be pressured to be someone I’m not.", t: "Phlegmatic", i: "Affable" },
      { text: "Knowing they will love me sacrificially even if I don’t ask.", t: "Supine", i: "Commitment" }
    ]
  },
  {
    q: "What creates tension for you in your marriage more than anything else?",
    opts: [
      { text: "A loss of playfulness, connection, or shared joy.", t: "Sanguine", i: "Recreational" },
      { text: "Disorganization or a lack of follow-through on goals.", t: "Choleric", i: "Conflict" },
      { text: "Feeling misunderstood or disrespected.", t: "Melancholy", i: "Intellectual" },
      { text: "Pressure to change or dealing with too much conflict.", t: "Phlegmatic", i: "Affable" },
      { text: "Feeling taken for granted or not being appreciated.", t: "Supine", i: "Commitment" }
    ]
  },
  {
    q: "How do you typically respond to disconnection in your marriage?",
    opts: [
      { text: "I try to bring lightheartedness and fun back to our interactions.", t: "Sanguine", i: "Recreational" },
      { text: "I get frustrated and push for us to work on a solution.", t: "Choleric", i: "Conflict" },
      { text: "I retreat inward and try to understand what's happening.", t: "Melancholy", i: "Intellectual" },
      { text: "I pull away slightly, hoping the tension will pass peacefully.", t: "Phlegmatic", i: "Affable" },
      { text: "I feel hurt and tend to serve even more, hoping it will close the gap.", t: "Supine", i: "Commitment" }
    ]
  },

  // 40–48
  {
    q: "What makes you feel most seen and understood in your relationship?",
    opts: [
      { text: "When they laugh with me and genuinely enjoy my presence.", t: "Sanguine", i: "Emotional" },
      { text: "When they trust my ability to lead or handle a situation.", t: "Choleric", i: "Partnership" },
      { text: "When they engage in meaningful conversations and reflect on my words.", t: "Melancholy", i: "Intellectual" },
      { text: "When they give me space to just be and feel accepted for who I am.", t: "Phlegmatic", i: "Physical" },
      { text: "When they remember the small, quiet things I do for them.", t: "Supine", i: "Commitment" }
    ]
  },
  {
    q: "Imagine your spouse is giving you a gift. Which kind would feel most meaningful to you?",
    opts: [
      { text: "A surprise experience or something fun we can do together!", t: "Sanguine", i: "Recreational" },
      { text: "Something practical that supports our shared goals.", t: "Choleric", i: "Partnership" },
      { text: "A thoughtful, symbolic gift with a deep, personal meaning.", t: "Melancholy", i: "Creative" },
      { text: "Something cozy or comforting that brings me a sense of peace.", t: "Phlegmatic", i: "Physical" },
      { text: "A gift that shows they were thinking of me without being told to.", t: "Supine", i: "Commitment" }
    ]
  },
  {
    q: "When you're upset, what do you most need to feel better?",
    opts: [
      { text: "A distraction or something fun to lift my mood.", t: "Sanguine", i: "Recreational" },
      { text: "Someone to help me fix the problem quickly.", t: "Choleric", i: "Conflict" },
      { text: "Empathy and someone to help me explore the emotions underneath.", t: "Melancholy", i: "Emotional" },
      { text: "A calm environment and someone who will just be present with me.", t: "Phlegmatic", i: "Affable" },
      { text: "Gentle, empathetic reassurance through service or consistency.", t: "Supine", i: "Commitment" }
    ]
  },
  {
    q: "What's the best way your spouse can show you respect?",
    opts: [
      { text: "By valuing my ideas and including me in the fun.", t: "Sanguine", i: "Affable" },
      { text: "By following through and working with me toward our shared goals.", t: "Choleric", i: "Partnership" },
      { text: "By taking the time to understand my inner world.", t: "Melancholy", i: "Emotional" },
      { text: "By accepting my steady nature without trying to change me.", t: "Phlegmatic", i: "Physical" },
      { text: "By honoring my efforts and loyalty, even when they're unseen.", t: "Supine", i: "Commitment" }
    ]
  },
  {
    q: "What kind of surprise would feel the most special to you?",
    opts: [
      { text: "A spontaneous outing or a fun moment together.", t: "Sanguine", i: "Recreational" },
      { text: "A planned accomplishment or a goal checked off for me.", t: "Choleric", i: "Partnership" },
      { text: "A handwritten note or a gift with personal, deep meaning.", t: "Melancholy", i: "Creative" },
      { text: "A peaceful act of service done without fanfare.", t: "Phlegmatic", i: "Affable" },
      { text: "Something quietly thoughtful that shows they were paying attention.", t: "Supine", i: "Commitment" }
    ]
  },
  {
    q: "Which of these would restore connection fastest after an argument?",
    opts: [
      { text: "Laughing together or sharing a lighthearted moment.", t: "Sanguine", i: "Recreational" },
      { text: "A plan to move forward and address the problem.", t: "Choleric", i: "Conflict" },
      { text: "A heartfelt conversation and a sincere apology.", t: "Melancholy", i: "Emotional" },
      { text: "A peaceful gesture or quiet physical reassurance.", t: "Phlegmatic", i: "Physical" },
      { text: "An act of service or a small kindness that shows they still care.", t: "Supine", i: "Commitment" }
    ]
  },
  {
    q: "How do you prefer to show love to your spouse?",
    opts: [
      { text: "Through physical affection or shared fun and high emotional energy.", t: "Sanguine", i: "Recreational" },
      { text: "By taking responsibility and helping us achieve our goals.", t: "Choleric", i: "Partnership" },
      { text: "Through words of affirmation and deep conversations.", t: "Melancholy", i: "Emotional" },
      { text: "Through gentle presence and physical comfort.", t: "Phlegmatic", i: "Physical" },
      { text: "Through faithful, quiet service and loyalty.", t: "Supine", i: "Commitment" }
    ]
  },
  {
    q: "What helps you feel most emotionally secure in your marriage?",
    opts: [
      { text: "Knowing we can laugh and have fun no matter what.", t: "Sanguine", i: "Affable" },
      { text: "Seeing consistent effort toward our shared life.", t: "Choleric", i: "Partnership" },
      { text: "Having my inner world known and accepted.", t: "Melancholy", i: "Emotional" },
      { text: "Feeling their steady, unrushed presence.", t: "Phlegmatic", i: "Physical" },
      { text: "Being cherished and chosen, even without words.", t: "Supine", i: "Commitment" }
    ]
  },
  // Q48 (added to complete 48)
  {
    q: "Which weekly ritual would most strengthen your connection right now?",
    opts: [
      { text: "A playful date or shared fun activity.", t: "Sanguine", i: "Recreational" },
      { text: "A focused planning check-in to align goals.", t: "Choleric", i: "Partnership" },
      { text: "A deep-conversation night to share hearts.", t: "Melancholy", i: "Emotional" },
      { text: "A quiet walk or cuddle time with no agenda.", t: "Phlegmatic", i: "Physical" },
      { text: "A small, consistent act of service they do for me.", t: "Supine", i: "Commitment" }
    ]
  },
  // Questions 49–53: Respect & Recognition
  {
    q: "Thinking about how you and your spouse make decisions together, do you feel your opinions are truly valued and respected?",
    opts: [
      { text: "Strongly Agree", rr: 3 },
      { text: "Agree", rr: 2 },
      { text: "Somewhat Agree", rr: 1 },
      { text: "Disagree", rr: 0 },
      { text: "Strongly Disagree", rr: 0 }
    ]
  },
  {
    q: "When you look at your core values and life goals, do you feel you and your spouse are aligned?",
    opts: [
      { text: "Strongly Agree", rr: 3 },
      { text: "Agree", rr: 2 },
      { text: "Somewhat Agree", rr: 1 },
      { text: "Disagree", rr: 0 },
      { text: "Strongly Disagree", rr: 0 }
    ]
  },
  {
    q: "Do you feel your spouse appreciates the unique strengths and contributions you bring to your marriage?",
    opts: [
      { text: "Strongly Agree", rr: 3 },
      { text: "Agree", rr: 2 },
      { text: "Somewhat Agree", rr: 1 },
      { text: "Disagree", rr: 0 },
      { text: "Strongly Disagree", rr: 0 }
    ]
  },
  {
    q: "When you express your needs or boundaries, does your spouse listen and take them seriously?",
    opts: [
      { text: "Strongly Agree", rr: 3 },
      { text: "Agree", rr: 2 },
      { text: "Somewhat Agree", rr: 1 },
      { text: "Disagree", rr: 0 },
      { text: "Strongly Disagree", rr: 0 }
    ]
  },
  {
    q: "How often do you and your spouse talk about and support each other's long-term dreams and priorities?",
    opts: [
      { text: "Strongly Agree", rr: 3 },
      { text: "Agree", rr: 2 },
      { text: "Somewhat Agree", rr: 1 },
      { text: "Disagree", rr: 0 },
      { text: "Strongly Disagree", rr: 0 }
    ]
  }
];

/* State Variables */
let index = 0,
    tempScores = {},
    wantedTempScores = {},
    socialTempScores = {},
    decisionTempScores = {},
    intimacyScores = {},
    bondingScores = {},
    respectRecognitionScore = 0,
    answers = [];

// Initialize score objects
["Sanguine", "Choleric", "Melancholy", "Phlegmatic", "Supine"].forEach(t => {
  tempScores[t] = 0;
  wantedTempScores[t] = 0;
  socialTempScores[t] = 0;
  decisionTempScores[t] = 0;
});

/* Reset Scores Function */
function resetScores() {
  try {
    tempScores = { Sanguine: 0, Choleric: 0, Melancholy: 0, Phlegmatic: 0, Supine: 0 };
    wantedTempScores = { Sanguine: 0, Choleric: 0, Melancholy: 0, Phlegmatic: 0, Supine: 0 };
    socialTempScores = { Sanguine: 0, Choleric: 0, Melancholy: 0, Phlegmatic: 0, Supine: 0 };
    decisionTempScores = { Sanguine: 0, Choleric: 0, Melancholy: 0, Phlegmatic: 0, Supine: 0 };
    intimacyScores = {};
    Object.keys(intimacyDescriptions).forEach(k => intimacyScores[k] = 0);
    bondingScores = {};
    respectRecognitionScore = 0;
    answers = [];
  } catch (error) {
    console.error("Error in resetScores:", error);
  }
}

/* Normalize Intimacy Scores */
function normalizeIntimacyScores() {
  const questionCounts = {
    Spiritual: 12, Emotional: 13, Commitment: 8, Intellectual: 9, Affable: 12,
    Recreational: 7, Partnership: 12, Financial: 3, Creative: 7, Conflict: 5,
    Physical: 11, Sexual: 3
  };
  const normalizedScores = {};
  Object.keys(intimacyScores).forEach(type => {
    normalizedScores[type] = questionCounts[type]
      ? (intimacyScores[type] / questionCounts[type]) * 3
      : 0;
  });
  return normalizedScores;
}

/* Get Affection Preferences */
function getAffectionPreferences() {
  const highestExpressed = Object.entries(tempScores).sort((a, b) => b[1] - a[1])[0][0];
  const highestWanted = Object.entries(wantedTempScores).sort((a, b) => b[1] - a[1])[0][0];
  
  const preferences = {
    Sanguine: { 
      expressed: "You show affection through playful, spontaneous gestures that bring joy to your spouse. Whether it’s a lighthearted joke, a surprise outing, or lively conversation, you love keeping the mood upbeat. Your affection is vibrant and engaging, making your spouse feel cherished through shared fun. Your enthusiasm creates memorable moments of connection.", 
      desired: "You feel most loved when your spouse joins you in playful, spontaneous moments. Their laughter, shared jokes, or participation in fun activities make you feel connected. You thrive on emotional warmth and lighthearted interactions that keep the relationship lively. These moments recharge your bond and bring you closer." 
    },
    Choleric: { 
      expressed: "You show affection by taking initiative to support your spouse, often through practical actions like tackling shared tasks or planning meaningful goals together. Your decisiveness shines as you prioritize acts of service that strengthen your partnership. You thrive on creating a sense of unity through shared accomplishments. Your efforts demonstrate deep commitment.", 
      desired: "You feel most loved when your spouse respects your decisions and actively collaborates with you. Their acknowledgment of your leadership and commitment to shared goals makes you feel valued. You appreciate clear, intentional support that reinforces your teamwork. Their partnership fuels your sense of connection." 
    },
    Melancholy: { 
      expressed: "You express affection through thoughtful, meaningful gestures, such as writing heartfelt notes or engaging in deep conversations. Your care is shown through attention to detail and creating moments that resonate emotionally. You aim to make your spouse feel truly understood and valued. Your sincerity fosters profound intimacy.", 
      desired: "You feel most loved when your spouse engages in deep, meaningful conversations that show they understand you. Their consistency in listening and valuing your emotions makes you feel secure. You cherish moments of intellectual and emotional connection that deepen your bond. These interactions make you feel truly known." 
    },
    Phlegmatic: { 
      expressed: "You show affection through calm, steady presence, often offering quiet support or gentle touch. Your reliability shines as you create a safe, comforting space for your spouse. You express love through consistent, understated acts that foster security. Your presence is a grounding force.", 
      desired: "You feel most loved when your spouse offers gentle, consistent affection, such as quiet companionship or physical closeness. Their calm support and presence make you feel secure and valued. You thrive on low-pressure, comforting interactions that build trust. These moments nurture your connection." 
    },
    Supine: { 
      expressed: "You express affection through selfless acts of service, often putting your spouse’s needs first without expecting recognition. Your loyalty shines in quiet sacrifices, like helping with tasks or supporting their goals. Your love is shown through dependable, heartfelt care. Your devotion strengthens your bond.", 
      desired: "You feel most loved when your spouse actively pursues you with affirmations and emotional support. Their intentional efforts to make you feel safe and valued resonate deeply. You thrive on being reassured and cherished through consistent, caring actions. Their pursuit makes you feel secure." 
    }
  };

  return {
    expressed: preferences[highestExpressed].expressed,
    expressedType: highestExpressed + "Express",
    desired: preferences[highestWanted].desired,
    desiredType: highestWanted + "Receive"
  };
}

/* Get Social Preferences */
function getSocialPreferences() {
  const highest = Object.entries(socialTempScores).sort((a, b) => b[1] - a[1])[0][0];
  switch(highest) {
    case "Sanguine": return "You enjoy being outgoing and engaging socially, bringing energy and fun to group settings. Your lively presence draws others in, creating a warm atmosphere. You thrive in dynamic interactions that spark joy.";
    case "Choleric": return "You prefer leading and organizing social interactions, taking charge to ensure everyone is included. Your confidence guides groups effectively, fostering structure. You excel in directing social dynamics with purpose.";
    case "Melancholy": return "You enjoy observing and having deep conversations, connecting thoughtfully with others. Your reflective nature fosters meaningful exchanges, valuing quality over quantity. You shine in intimate, insightful discussions.";
    case "Phlegmatic": return "You prefer calm, low-key social interactions, blending in comfortably with others. Your relaxed demeanor creates a peaceful environment, making others feel at ease. You value harmonious, understated connections.";
    case "Supine": return "You enjoy supporting others quietly in social settings, helping everyone feel included. Your selfless approach fosters warmth and inclusion, often behind the scenes. You find joy in serving others socially.";
    default: return "You have balanced social preferences, adapting to various social settings with ease. Your flexibility allows you to connect comfortably in diverse situations. You navigate social dynamics with versatility.";
  }
}

/* Get Decision Style */
function getDecisionLeadershipStyle() {
  const highest = Object.entries(decisionTempScores).sort((a, b) => b[1] - a[1])[0][0];
  switch(highest) {
    case "Sanguine": return "You lead with enthusiasm and fun, inspiring others with your energy. Your vibrant approach motivates teams, creating an engaging atmosphere. You make decisions with a focus on enjoyment.";
    case "Choleric": return "You lead decisively and confidently, taking charge to achieve goals. Your strong will drives progress, ensuring efficient outcomes. You excel in making firm, goal-oriented decisions.";
    case "Melancholy": return "You lead with careful planning and analysis, ensuring thoughtful decisions. Your attention to detail creates reliable strategies, fostering trust. You prioritize precision in leadership.";
    case "Phlegmatic": return "You lead by fostering harmony and agreement, prioritizing team unity. Your calm approach encourages collaboration, maintaining peace. You make decisions that promote group cohesion.";
    case "Supine": return "You prefer following others’ lead, supporting their vision willingly. Your supportive nature strengthens team efforts, offering loyalty. You contribute by aligning with others’ decisions.";
    default: return "You have a balanced approach to decision-making and leadership. Your adaptability allows you to lead or follow as needed, ensuring flexibility. You navigate decisions with ease.";
  }
}

/* Get Bonding Style */
function getBondingStyle() {
  const highest = Object.entries(bondingScores).sort((a, b) => b[1] - a[1])[0]?.[0] || "SteadyConnector";
  return highest.replace(/\s/g, "");
}

/* Quiz Initialization */
document.addEventListener("DOMContentLoaded", () => {
  const startBtn = document.getElementById("startQuizBtn");
  if (startBtn) {
    startBtn.addEventListener("click", startQuiz);
  } else {
    console.error("Start button with ID 'startQuizBtn' not found.");
  }
});

/* Start Quiz */
function startQuiz() {
  try {
    const introPage = document.getElementById("introPage");
    const quizPage = document.getElementById("quizPage");
    if (!introPage || !quizPage) {
      throw new Error("Required DOM elements (introPage or quizPage) not found.");
    }
    resetScores();
    index = 0;
    introPage.classList.add("hidden");
    quizPage.classList.remove("hidden");
    showQuestion();
  } catch (error) {
    console.error("Error starting quiz:", error);
    alert("Failed to start the quiz. Please try refreshing the page.");
  }
}

/* Show Question */
function showQuestion() {
  try {
    if (!questions[index]) throw new Error(`Question at index ${index} not found.`);
    const q = questions[index];
    const progress = document.getElementById("progress");
    const progressBar = document.getElementById("progressBar");
    const questionContainer = document.getElementById("questionContainer");
    if (!progress || !progressBar || !questionContainer) {
      throw new Error("Required DOM elements (progress, progressBar, or questionContainer) not found.");
    }

    progress.textContent = `Question ${index + 1} of ${questions.length}`;
    progressBar.style.width = `${((index + 1) / questions.length) * 100}%`;

    let html = `<h3 id="questionLabel">${q.q}</h3>`;
    q.opts.forEach((o, i) => {
      html += `<button class="answer-btn" role="radio" aria-checked="false" aria-labelledby="questionLabel" onclick="answer(${i})">${o.text}</button>`;
    });
    questionContainer.innerHTML = html;

    const backBtn = document.getElementById("backBtn");
    if (backBtn) {
      backBtn.style.display = index > 0 ? "block" : "none";
    }
  } catch (error) {
    console.error("Error showing question:", error);
    alert("Error loading question. Please try refreshing the page.");
  }
}

/* Answer Function */
function answer(i) {
  try {
    const buttons = document.querySelectorAll('.answer-btn');
    if (!buttons[i] || !questions[index]?.opts[i]) {
      throw new Error("Invalid answer selection.");
    }
    buttons[i].classList.add('selected');
    setTimeout(() => buttons[i]?.classList.remove('selected'), 200);

    const o = questions[index].opts[i];
    answers[index] = i;

    if (o.t) {
      if (o.domain === "Affection" && o.wanted) wantedTempScores[o.t]++;
      else if (o.domain === "Social") socialTempScores[o.t]++;
      else if (o.domain === "Decision") decisionTempScores[o.t]++;
      else tempScores[o.t]++;
    }
    if (o.i) intimacyScores[o.i] = (intimacyScores[o.i] || 0) + 1;
    if (o.b) bondingScores[o.b] = (bondingScores[o.b] || 0) + 1;
    if (o.rr !== undefined) respectRecognitionScore += o.rr;

    index++;
    index < questions.length ? showQuestion() : showResults();
  } catch (error) {
    console.error("Error processing answer:", error);
    alert("Error processing answer. Please try again.");
  }
}

/* Go Back to Previous Question */
function goBack() {
  try {
    if (index > 0) {
      index--;
      const prevAnswer = answers[index];
      const o = questions[index].opts[prevAnswer];

      if (o.t) {
        if (o.domain === "Affection" && o.wanted) wantedTempScores[o.t]--;
        else if (o.domain === "Social") socialTempScores[o.t]--;
        else if (o.domain === "Decision") decisionTempScores[o.t]--;
        else tempScores[o.t]--;
      }
      if (o.i) intimacyScores[o.i]--;
      if (o.b) bondingScores[o.b]--;
      if (o.rr !== undefined) respectRecognitionScore -= o.rr;

      showQuestion();
    }
  } catch (error) {
    console.error("Error going back:", error);
    alert("Error navigating back. Please try refreshing the page.");
  }
}

/* Show Results */
function showResults() {
  try {
    const quizPage = document.getElementById("quizPage");
    const resultPage = document.getElementById("resultPage");
    if (!quizPage || !resultPage) throw new Error("Required DOM elements (quizPage or resultPage) not found.");

    quizPage.classList.add("hidden");
    resultPage.classList.remove("hidden");

    const normalizedScores = normalizeIntimacyScores();
    const sorted = Object.entries(normalizedScores).sort((a, b) => b[1] - a[1]);

    const priority = sorted.slice(0, 4);
    const progress = sorted.slice(4, 8);
    const presence = sorted.slice(8, 12);

    const socialPreferences = getSocialPreferences();
    const decisionLeadershipStyle = getDecisionLeadershipStyle();
    const affectionPrefs = getAffectionPreferences();
    const bondingStyle = getBondingStyle();

    const socialDescriptions = {
      Sanguine: "Extrovert – energized by people, thrives in group settings, and loves shared experiences.",
      Choleric: "Extrovert with Purpose – enjoys social interaction when it serves a goal and leads confidently.",
      Melancholy: "Introvert – thoughtful and reflective, prefers meaningful one-on-one or small group interactions.",
      Phlegmatic: "Ambivert – enjoys people but needs downtime, balancing socializing with quiet time.",
      Supine: "Relational Introvert – desires connection but needs safety and invitation to engage."
    };
    const highestSocial = Object.entries(socialTempScores).sort((a,b)=>b[1]-a[1])[0]?.[0] || "Phlegmatic";

    const conflictStyles = {
      SteadyConnector: "May avoid addressing deeper issues to keep harmony, delaying resolution.",
      ReassuranceSeeker: "May become anxious and over-pursue reassurance during conflict.",
      IndependentConnector: "May withdraw or shut down instead of resolving issues.",
      GuardedConnector: "May assume negative intent and become defensive or distant."
    };

    const respectText = respectRecognitionScore >= 10
      ? "feel strongly respected and aligned in values/goals with your spouse."
      : respectRecognitionScore >= 6
      ? "have a moderate sense of respect and values alignment, with room for growth."
      : "may desire more recognition and alignment on values and goals.";

    function sectionHTML(title, text, items) {
      return `
        <h4 style="margin-bottom: 10px;">${title}</h4>
        <p>${text}</p>
        ${items.map(([type]) => `
          <div class="result-block" style="border-left:8px solid ${typeColors[type]}; background-color:${typeColorsWithOpacity[type]};">
            <strong>${type}</strong> – ${intimacyDescriptions[type].desc}<br/>
            <span class="action-tip">Tip: ${intimacyDescriptions[type].tip}</span>
          </div>
        `).join("")}
        <hr style="margin: 30px 0; border: 1px solid #E0E0E0;">
      `;
    }

    const results = document.getElementById("results");
    if (!results) throw new Error("Results element with ID 'results' not found.");

    results.innerHTML = `
      <p class="intro-text">
        This profile is designed to guide you toward a Happy Marriage, Happy Life™—a marriage filled with lasting love and fulfillment as God intended.
      </p>
      <p class="intro-text">
        Your results are based on the Covenant Intimacy Fulfillment Model™ (CIFM), developed through the research of Dr. Scott Inman, PhD, founder of the Happy Marriage, Happy Life™ marriage curriculum and resources.
      </p>

      <!-- Section 1: Intimacy Type Profile -->
      <hr style="margin: 30px 0; border: 1px solid #E0E0E0;">
      <h3>Section 1: Intimacy Type Profile</h3>
      ${sectionHTML("Natural Connection Strengths", "Your top four intimacy types are where you naturally invest the most energy.", priority)}
      ${sectionHTML("Growth Opportunities", "Your middle four intimacy types can grow with intentional focus.", progress)}
      ${sectionHTML("Overlooked Opportunities", "Your lowest four intimacy types may need more attention.", presence)}

      <!-- Section 2: Relational Dynamics -->
      <h3>Section 2: Relational Dynamics</h3>

      <h4>Compassion and Care</h4>
      <div class="result-block" style="border-left:8px solid ${typeColors[affectionPrefs.expressedType]}; background-color:${typeColorsWithOpacity[affectionPrefs.expressedType]};">
        <strong>How You Express Love:</strong> ${affectionPrefs.expressed}
      </div>
      <div class="result-block" style="border-left:8px solid ${typeColors[affectionPrefs.desiredType]}; background-color:${typeColorsWithOpacity[affectionPrefs.desiredType]};">
        <strong>How You Feel Most Loved:</strong> ${affectionPrefs.desired}
      </div>

      <h4>Social Preferences</h4>
      <div class="result-block" style="border-left:8px solid #FFB347; background-color:rgba(255,179,71,0.08);">
        <strong>Your Social Energy:</strong>
        <p style="margin:0 0 12px 0; line-height:1.3;">${socialDescriptions[highestSocial]}</p>
        <em>This is how you recharge and engage socially, helping you and your spouse balance connection and personal space.</em>
      </div>

      <h4>Power and Control</h4>
      <div class="result-block" style="border-left:8px solid #4d9de0; background-color:rgba(77,157,224,0.08);">
        <strong>Your Leadership Style in Marriage:</strong>
        <p style="margin:0 0 12px 0; line-height:1.3;">${decisionLeadershipStyle}</p>
        <em>This reflects how you approach decision-making and power. Use this awareness to ensure balance, shared respect, and collaboration.</em>
      </div>

      <h4>Respect and Recognition</h4>
      <div class="result-block" style="border-left:8px solid #8A2BE2; background-color:rgba(138,43,226,0.08);">
        <strong>Your Respect & Recognition Alignment:</strong>
        <p style="margin:0 0 12px 0; line-height:1.3;">Based on your answers, you ${respectText}</p>
      </div>

      <!-- Section 3: Connection and Conflict Patterns -->
      <hr style="margin: 30px 0; border: 1px solid #E0E0E0;">
      <h3>Section 3: Connection and Conflict Patterns</h3>

      <div class="result-block" style="border-left:8px solid ${typeColors[bondingStyle]}; background-color:${typeColorsWithOpacity[bondingStyle]};">
        <strong>Primary Connection Pattern:</strong>
        <p style="margin:0 0 12px 0; line-height:1.3;">${bondingStyle.replace(/([a-z])([A-Z])/g, '$1 $2')}</p>

        <strong>Strengths:</strong>
        <p style="margin:0 0 12px 0; line-height:1.3;">${bondingInsights[bondingStyle].desc}</p>

        <strong>Challenges:</strong>
        <p style="margin:0 0 12px 0; line-height:1.3;">${bondingInsights[bondingStyle].challenges}</p>

        <strong>Conflict Style:</strong>
        <p style="margin:0 0 12px 0; line-height:1.3;">${conflictStyles[bondingStyle]}</p>

        <strong>Growth Tip:</strong>
        <p style="margin:0; line-height:1.3;">${bondingInsights[bondingStyle].tip}</p>
      </div>

      <hr style="margin: 30px 0; border: 1px solid #E0E0E0;">
      <p style="text-align:center; color:#A3A3A3; font-size:0.9rem;">HappyMarriageHappyLife.com</p>
    `;
  } catch (error) {
    console.error("Error showing results:", error);
    alert("Error displaying results. Please try refreshing the page.");
  }
}

/* Validate and Send */
function validateAndSend() {
  try {
    const name = document.getElementById("nameInput")?.value.trim();
    const email = document.getElementById("emailInput")?.value.trim();
    
    let valid = true;

    if (!name) {
      document.getElementById("nameError").style.display = "block";
      valid = false;
    } else {
      document.getElementById("nameError").style.display = "none";
    }

    if (!email || !email.includes("@")) {
      document.getElementById("emailError").style.display = "block";
      valid = false;
    } else {
      document.getElementById("emailError").style.display = "none";
    }

    if (valid) {
      generatePDF(name);
    }
  } catch (error) {
    console.error("Error validating form:", error);
    alert("Error processing form. Please try again.");
  }
}

/* PDF Generation */
async function generatePDF(name) {
  try {
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF("p", "pt", "a4");
    const resultsElement = document.getElementById("results");

    // Margins in points (0.75 inch ≈ 54pt)
    const marginX = 54;
    const marginY = 54;

    // Logo URL
    const logoUrl = "https://static.wixstatic.com/media/4d6372_c110ccf05896482192f466d6c0e3c1ae~mv2.png/v1/fill/w_476,h_194,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/Untitled-28_edited.png";

    // Load results content as canvas
    const canvas = await html2canvas(resultsElement, { scale: 2 });
    const imgData = canvas.toDataURL("image/png");

    const imgProps = pdf.getImageProperties(imgData);
    const pdfWidth = pdf.internal.pageSize.getWidth() - marginX * 2;
    const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

    // Add logo at top center of first page with 0.75 inch margin from top
    try {
      const logoImg = await fetch(logoUrl).then(res => res.blob()).then(blob => new Promise(resolve => {
        const reader = new FileReader();
        reader.onloadend = () => resolve(reader.result);
        reader.readAsDataURL(blob);
      }));
      const pageWidth = pdf.internal.pageSize.getWidth();
      const logoWidth = 150;
      const logoHeight = 60;
      const logoX = (pageWidth - logoWidth) / 2; // center horizontally
      pdf.addImage(logoImg, "PNG", logoX, marginY, logoWidth, logoHeight);
    } catch (e) {
      console.warn("Logo failed to load.");
    }

    // Add title under the logo with 18pt space
    pdf.setFont("helvetica", "bold");
    pdf.setFontSize(15);
    pdf.setTextColor(26, 60, 94);
    const titleY = marginY + 60 + 18; // 60 is logo height, 18pt space below
    pdf.text("Your Personalized Connection Profile", pdf.internal.pageSize.getWidth() / 2, titleY, { align: "center" });

    // Offset content below the title
    let position = titleY + 24; // add extra space before content
    let heightLeft = pdfHeight;

    pdf.addImage(imgData, "PNG", marginX, position, pdfWidth, pdfHeight);
    heightLeft -= pdf.internal.pageSize.getHeight() - marginY * 2;

    // Add remaining pages if needed
    while (heightLeft > 0) {
      position = heightLeft - pdfHeight + marginY;
      pdf.addPage();
      pdf.addImage(imgData, "PNG", marginX, position, pdfWidth, pdfHeight);
      heightLeft -= pdf.internal.pageSize.getHeight() - marginY * 2;
    }

    pdf.save(`Marriage_Connection_Profile_${name.replace(/\s/g, "_")}.pdf`);
  } catch (err) {
    console.error("PDF Generation Error:", err);
    alert("Failed to generate PDF. Please try again.");
  }
}

</script>
</body>
</html>
