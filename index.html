<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0"/>
<meta http-equiv="Pragma" content="no-cache"/>
<meta http-equiv="Expires" content="0"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Marriage Connection Assessment — Individual</title>

<!-- ===========================================================
     PATCH NOTES (v13k):
     - Section 3 renamed to "Communication Style" (removed "(CCMM-Aligned)")
     - Removed Section 3 balance scale / matrix button entirely
     - New Communication Style results with 6 styles + tailored strategy
     - Kept all v13j upgrades (Section 2 wording, framing questions, prompts,
       Compassion & Care detail spacing, unified answer buttons)
     - (Merged Patch) Restored "Connection Patterns" section
     - (Merged Patch) Replaced Section 2 Compassion & Care + R&R with teaching copy
     =========================================================== -->

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@500&family=Open+Sans:wght@600;700&family=Merriweather:ital,wght@1,400;1,700&family=Great+Vibes&display=swap" rel="stylesheet">

<style>
  /* Step 0 picker cards */
  .mini-grid { display:flex; flex-wrap:wrap; gap:10px; justify-content:center; }
  .mini-card {
    border:1px solid #4D9DE0; border-radius:8px; background:#fff;
    padding:10px 12px; max-width:360px; flex:1 1 280px; cursor:pointer;
    transition: box-shadow .15s, border-color .15s, background .15s;
  }
  .mini-card.selected { background: rgba(77,157,224,0.08); border-color:#3A7FBF; box-shadow: 0 0 0 2px rgba(58,127,191,0.20) inset; }
  .mini-title { font-weight:700; margin:0 0 6px 0; }
  .mini-desc  { font-size:.95rem; color:#4a607a; line-height:1.3; margin:0; }

  body { font-family: Arial, sans-serif; background:#FFF9F2; color:#1A3C5E; max-width: 980px; margin:auto; padding:20px; box-sizing:border-box; }
  h1,h2,h3,h4{ text-align:center; line-height:1.25; }
  .card { background:#fff; border:2px solid #4D9DE0; border-radius:12px; padding:24px; box-shadow:0 8px 25px rgba(0,0,0,.08); margin: 20px auto; }
  .btn { background:#4D9DE0; color:#fff; font-weight:700; border:none; border-radius:8px; padding:12px 16px; cursor:pointer; margin:10px auto; display:block; width:100%; max-width:520px; }
  .btn:hover { background:#3A7FBF; }
  .hidden{ display:none; }
  .progress-bar-container{ width:100%; max-width:520px; height:10px; background:#E0E0E0; border-radius:5px; margin:8px auto 4px; }
  .progress-bar{ height:100%; background:#FF4D4D; border-radius:5px; transition:width .25s; }
  .muted{ color:#9aa3ab; text-align:center; margin-top:12px; font-size:12px; }
  .muted a{ color:#9aa3ab; text-decoration:none; }
  .muted a:hover{ text-decoration:underline; }

  /* Intro tweaks */
  #introPage .intro-text { text-align:center; }
  #introPage .aha { font-style:italic; font-size:1.35rem; margin:0 0 8px 0; }

  /* Unified answer style */
  .pill, .answer-btn{
    background:#fff !important; color:#1A3C5E !important;
    font-weight:400; font-size:1rem;
    border:1.5px solid #4D9DE0 !important;
    border-radius:8px; padding:12px 14px; cursor:pointer;
    margin:8px auto; display:block; width:100%; max-width:520px; text-align:center;
  }
  .pill.selected{ background:rgba(77,157,224,0.08); border-color:#3A7FBF; }
  .answer-btn:hover,.pill:hover{ background:rgba(77,157,224,0.08) !important; }
  .vertical-list{ display:flex; flex-direction:column; align-items:center; justify-content:flex-start; }

  /* Results */
  .result-block { margin-bottom:16px; page-break-inside:avoid; padding:16px; border-left:8px solid #4D9DE0; border-radius:8px; background:#fff; line-height:1.3; }
  .section-title { color:#1A3C5E; font-family:'Open Sans',sans-serif; font-weight:700; font-size:16pt; margin-bottom:10px; }
  .subsection-title { color:#1A3C5E; font-family:'Roboto',sans-serif; font-weight:600; font-size:14pt; margin: 15px 0 8px; text-align:center; }
  .section-divider{ height:1pt; background-color:#FF4D4D; width:100%; max-width:860px; margin:24pt auto; }
  .subsection-divider{ height:1pt; background-color:rgba(77,157,224,.5); width:100%; max-width:860px; margin:14pt auto; }
  .verse{ font-family:'Merriweather', serif; font-style:italic; color:#FF4D4D; text-align:center; margin:4px auto 10px; max-width:820px; }
  .intro-text{ margin:8px auto 12px; line-height:1.45; }
  .prompt-block { border-left:8px solid #4D9DE0; background: rgba(77,157,224,0.08); border-radius:8px; padding:16px; margin:16px 0; }
  .partner-header{ font-weight:700; text-align:center; margin-bottom:6px; }
  .results-list{ list-style-position:outside; margin-left:20px; text-align:left; }
  .results-list li{ margin-bottom:6px; }

  /* Framing question line */
  .framing-q{
    text-align:center; font-style:italic; color:#4D9DE0; font-size:14pt;
    margin: 2px 0 6px 0;
  }

  .aff-detail{ line-height:1.3; margin: 8px 0; }

  .thank-title{
    margin-top:0; margin-bottom:12pt; font-family:'Savoye LET','Zapfino','Great Vibes',cursive;
    color:#4D9DE0; font-size:4.4rem; line-height:1.1; text-align:center;
  }
  @media (max-width:700px){ .thank-title{ font-size:3.2rem; } }
  @media (max-width:420px){ .thank-title{ font-size:2.6rem; } }

  @media print { .btn { display:none !important; } .card { border:none; box-shadow:none; } body { background:#fff; } }
</style>
</head>
<body>

<!-- Intro Page -->
<div id="introPage" class="card">
  <img src="https://static.wixstatic.com/media/4d6372_c110ccf05896482192f466d6c0e3c1ae~mv2.png" alt="Logo" style="display:block; margin:0 auto 12px; max-width:200px;" onerror="this.src='https://via.placeholder.com/200x80?text=Logo'">
  <h1>Your Guide to a Deeper Connection</h1>
  <div class="intro-text">
    <p class="aha"><em>Ready for a few “aha!” moments?</em></p>
    <p>This <strong>questionnaire</strong> is all about exploring how you and your partner connect and what builds intimacy. After you answer a few quick questions, you'll get a personalized profile with simple, actionable ideas to help you build more intimacy and navigate your daily life together.</p>
    <p style="margin-bottom:0.2em;"><strong>How it works</strong></p>
    <div class="lh-13" style="margin-top:0;">
      <p style="margin:0;">Just enter your name to get started. Don't overthink it—your honest answers are the only ones that matter.</p>
    </div>
  </div>
  <div class="row mt-24pt" style="display:flex; gap:12px; justify-content:center; flex-wrap:wrap;">
    <input id="yourName" class="input" placeholder="Your name" aria-label="Your name" style="border:1px solid #4D9DE0; border-radius:8px; padding:10px 12px; min-width:260px; text-align:center;">
  </div>
  <div style="display:flex; gap:12px; justify-content:center; flex-wrap:wrap; margin-top:10px;">
    <button id="startFreshBtn" class="btn" style="max-width:240px;">Start Assessment</button>
    <button id="resumeBtn" class="btn hidden" style="max-width:240px; background:#6A4C93;">Resume Saved Progress</button>
  </div>
  <p class="muted"
     title="The Covenant Intimacy Fulfillment Model™ (CIFM) is the original intellectual property of Dr. Scott Inman, PhD. It was developed through the research of Happy Marriage, Happy Life™ and the Comprehensive Covenant Marriage Model™ (CCMM). All rights reserved. Unauthorized reproduction or distribution is prohibited.">
    © 2025 Dr. Scott Inman, PhD. All rights reserved.<br/>CIFM™ is proprietary to Dr. Inman.
  </p>
</div>

<!-- Quiz Page -->
<div id="quizPage" class="card hidden">
  <h2 id="quizTitle">Assessment</h2>
  <div class="progress-bar-container"><div class="progress-bar" id="progressBar"></div></div>
  <div id="progress" style="text-align:center; margin-bottom:8px;"></div>
  <div id="questionContainer" class="question-box"></div>
  <p class="muted"><a href="https://happymarriagehappylife.com" target="_blank" rel="noopener">HappyMarriageHappyLife.com</a></p>
</div>

<!-- Results Page -->
<div id="resultPage" class="card hidden">
  <img src="https://static.wixstatic.com/media/4d6372_c110ccf05896482192f466d6c0e3c1ae~mv2.png" alt="Logo" style="display:block; margin:0 auto 12px; max-width:200px;" onerror="this.src='https://via.placeholder.com/200x80?text=Logo'">
  <h2 id="resultsHeader">Your Relational Connection Profile</h2>
  <div id="resultsIntro" class="intro-text">
    <p>Welcome to the Marriage Connection Assessment, a guided experience designed to help you build a covenant, joy-filled marriage as God designed.</p>
    <p>This is your personalized guide to understanding connection in a new way. Think of this not as a set of labels, but as a living map to the unique landscape of your relationship—it helps you name what’s true today and aim for what’s possible tomorrow.</p>
  </div>
  <div id="results"></div>
  <p class="muted">Build: <span id="buildBadgeResults"></span></p>
</div>

<script>
/* Build marker */
const BUILD = "individual-v13k";
document.addEventListener('DOMContentLoaded', () => {
  const r = document.getElementById('buildBadgeResults'); if (r) r.textContent = BUILD;
  if (localStorage.getItem('mca_individual_state_v1')) document.getElementById('resumeBtn').classList.remove('hidden');
});

/* Data & palettes */
const INTIMACY = {
  Spiritual:{label:"Spiritual Intimacy", desc:"Spiritual intimacy is the shared sense of purpose and connection to God’s design that anchors a relationship. It’s the core that shapes how love is experienced and expressed, guiding your journey together."},
  Emotional:{label:"Emotional Intimacy", desc:"Emotional intimacy is the key to deep connection, creating a safe space for vulnerability and empathy. This crucial bond is the gateway that allows all other forms of closeness to flourish."},
  Commitment:{label:"Commitment Intimacy", desc:"Commitment intimacy is the security and dedication that acts as the core of a relationship, providing the stability needed to weather life’s storms. This dedicated bond is what allows a couple to face challenges and deepen their connection over time."},
  Intellectual:{label:"Intellectual Intimacy", desc:"Intellectual intimacy is about sharing a mental and emotional connection through engaging conversations and mutual respect for each other’s thoughts and values. It builds a powerful bond forged by the exchange of ideas and the exploration of new perspectives."},
  Affable:{label:"Affable Intimacy", desc:"Affable intimacy is the ease and comfort found in a relationship, creating a peaceful and enjoyable environment. It’s the simple joy of being agreeable and easygoing in your daily interactions with each other."},
  Conflict:{label:"Conflict Intimacy", desc:"Conflict intimacy is the ability to maintain a strong connection and mutual respect even during disagreements. It allows couples to navigate differences and grow closer through the process of resolving conflicts together."},
  Recreational:{label:"Recreational Intimacy", desc:"Recreational intimacy is about sharing laughter, playfulness, and joy through shared hobbies and experiences. It brings vitality and fun to a relationship, creating cherished memories that strengthen the bond."},
  Partnership:{label:"Partnership Intimacy", desc:"Partnership intimacy is the collaborative connection built by working together to manage daily responsibilities and make decisions. This forges a powerful bond as a couple functions as a unified team, tackling life’s challenges side by side."},
  Stability:{label:"Stability Intimacy", desc:"Stability intimacy is about transparently and honestly managing resources like time and money together, building a foundation of trust and a secure future. It’s a shared commitment to aligning your values as you work toward a common goal."},
  Creative:{label:"Creative Intimacy", desc:"Creative intimacy is the shared joy of bringing new ideas to life by building and dreaming together. This bond is strengthened through the process of collaborating on projects and seeing your shared vision become a reality."},
  Physical:{label:"Physical Intimacy", desc:"Physical intimacy involves connecting through non-sexual touch, comfort, and physical presence. This kind of closeness creates a sense of safety and security, affirming your bond through simple gestures and shared moments."},
  Sexual:{label:"Sexual Intimacy", desc:"Sexual intimacy is a passionate, exclusive, and sacred physical union that expresses a deep, committed connection. It’s a unique and powerful way to honor your bond through a shared experience of vulnerability and pleasure."}
};
const TYPES = Object.keys(INTIMACY);
const typeColors = {
  Spiritual:"#6A4C93", Emotional:"#FF7A70", Commitment:"#FFB347",
  Intellectual:"#4C6B9B", Affable:"#FFB6C1", Recreational:"#4DD2FF",
  Partnership:"#3CB371", Stability:"#FFD700", Creative:"#FF66CC",
  Conflict:"#FFA552", Physical:"#FF8C69", Sexual:"#E63946"
};
const typeOpac = {
  Spiritual:"rgba(106,76,147,.08)", Emotional:"rgba(255,122,112,.08)", Commitment:"rgba(255,179,71,.08)",
  Intellectual:"rgba(76,107,155,.08)", Affable:"rgba(255,182,193,.08)", Recreational:"rgba(77,210,255,.08)",
  Partnership:"rgba(60,179,113,.08)", Stability:"rgba(255,215,0,.08)", Creative:"rgba(255,102,204,.08)",
  Conflict:"rgba(255,165,82,.08)", Physical:"rgba(255,140,105,.08)", Sexual:"rgba(230,57,70,.08)"
};

/* State */
const STORAGE_KEY = "mca_individual_state_v1";
let yourName = "";
const TOTAL_STEPS = 14; // 0..13
let step = 0;

const DEFAULT_ANSWERS = {
  rank: [...TYPES],
  expressedTop2: [],
  desiredTop2: [],
  social: {},
  decision: {},
  rr: { rr1:null, rr2:null },
  bond: {},
  top4: [],
  next4: []
};
let answers = JSON.parse(JSON.stringify(DEFAULT_ANSWERS));

function ensureDefaults(){
  if (!answers || typeof answers !== 'object') answers = JSON.parse(JSON.stringify(DEFAULT_ANSWERS));
  if (!Array.isArray(answers.rank)  || answers.rank.some(k=>!INTIMACY[k])) answers.rank = [...TYPES];
  if (!Array.isArray(answers.expressedTop2)) answers.expressedTop2 = [];
  if (!Array.isArray(answers.desiredTop2))   answers.desiredTop2   = [];
  if (!answers.social || typeof answers.social !== 'object') answers.social = {};
  if (!answers.decision || typeof answers.decision !== 'object') answers.decision = {};
  if (!answers.rr || typeof answers.rr !== 'object') answers.rr = { rr1:null, rr2:null };
  if (!answers.bond || typeof answers.bond !== 'object') answers.bond = {};
  if (!Array.isArray(answers.top4))  answers.top4  = [];
  if (!Array.isArray(answers.next4)) answers.next4 = [];
  if (!Number.isInteger(step) || step < 0 || step >= TOTAL_STEPS) step = 0;
}
function saveState(){ ensureDefaults(); try { localStorage.setItem(STORAGE_KEY, JSON.stringify({ yourName, step, answers })); } catch(e){} }
function loadState(){
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return false;
    const s = JSON.parse(raw);
    if(s && typeof s === 'object'){
      yourName = s.yourName || yourName;
      step = Number.isInteger(s.step) ? s.step : step;
      answers = s.answers || answers;
      ensureDefaults(); return true;
    }
    return false;
  } catch(e){ return false; }
}
function clearState(){ try { localStorage.removeItem(STORAGE_KEY); } catch(e){} }

/* Launch */
document.getElementById('startFreshBtn').onclick = () => {
  try {
    clearState();
    yourName = (document.getElementById('yourName')?.value || "").trim() || "You";
    step = 0;
    answers = JSON.parse(JSON.stringify(DEFAULT_ANSWERS));
    saveState(); showQuiz();
  } catch (e) { console.error("Launch error:", e); alert("Oops — please reload the page."); }
};
document.getElementById('resumeBtn').onclick = () => {
  try {
    const restored = loadState();
    const typed = (document.getElementById('yourName')?.value || "").trim();
    if (typed) yourName = typed;
    ensureDefaults();
    if (!restored) step = 0;
    showQuiz();
  } catch (e) { console.error("Resume error:", e); alert("Couldn’t resume. Starting fresh."); clearState(); step = 0; answers = JSON.parse(JSON.stringify(DEFAULT_ANSWERS)); showQuiz(); }
};
function showQuiz(){
  hideAllPages();
  document.getElementById('quizPage').classList.remove('hidden');
  document.getElementById('quizTitle').textContent = `Assessment — ${yourName}`;
  renderStep();
}
function hideAllPages(){ document.getElementById('introPage').classList.add('hidden'); document.getElementById('quizPage').classList.add('hidden'); document.getElementById('resultPage').classList.add('hidden'); }

/* Helpers */
const codeToAffKey = (code)=>({ E:"Playful", S:"Initiative", R:"DeepTalk", A:"Warmth", U:"Support" }[code]);
const affKeyToTemp = (k)=>({ Playful:"E", Initiative:"S", DeepTalk:"R", Warmth:"A", Support:"U" }[k] || null);
const SANG="E", CHOL="S", MEL="R", PHLE="A", SUPI="U";

/* Renderer (Questionnaire — unchanged) */
function renderStep(){
  ensureDefaults();

  const progEl = document.getElementById('progress');
  const barEl  = document.getElementById('progressBar');
  if (progEl) progEl.textContent = `Step ${step+1} of ${TOTAL_STEPS}`;
  if (barEl)  barEl.style.width   = `${((step+1)/TOTAL_STEPS)*100}%`;

  const box = document.getElementById('questionContainer'); box.innerHTML = "";

  /* Step 0: Top/Next picker */
  if(step===0){ renderTopNextPicker(box); saveState(); return; }

  /* Affection (Expressed, Wanted-Emotional, Wanted-Daily) */
  if(step===1) return renderSingleList(box, "When it comes to showing affection in close relationships, I naturally…", [
    [SANG,"…initiate hugs, kisses, and warm words often; I easily express closeness."],
    [CHOL,"…show care through purposeful actions or brief gestures, less through emotional displays."],
    [MEL,"…reserve affection for a few, preferring deep talks or thoughtful acts over frequent touch."],
    [SUPI,"…hesitate to initiate affection, but show loyalty and care by being present and supportive."],
    [PHLE,"…offer steady, quiet companionship, showing affection in calm, consistent ways."]
  ], val => { 
      const k = codeToAffKey(val); answers.expressedTop2 = k ? [k] : []; saveState(); next(); 
  });

  if(step===2) return renderSingleList(box, "To feel most loved and secure, I need my partner to…", [
    [SANG,"…frequently affirm me with words, touch, and celebratory gestures."],
    [CHOL,"…respect my independence, affirming my efforts more than giving constant affection."],
    [MEL,"…share deep emotional connection and understanding, not constant gestures."],
    [SUPI,"…initiate affection often so I feel needed and cherished without asking."],
    [PHLE,"…be present and kind in simple, low-pressure ways that make me feel secure."]
  ], val => {
      const k = codeToAffKey(val); const arr = answers.desiredTop2 || [];
      if(k && !arr.includes(k) && arr.length<2) arr.push(k);
      answers.desiredTop2 = arr; saveState(); next();
  });

  if(step===3) return renderSingleList(box, "Day to day, I feel most cared for when my partner…", [
    [SANG,"…keeps closeness fun and frequent with lighthearted affection."],
    [CHOL,"…takes initiative to solve problems or reduce stress for me."],
    [MEL,"…creates space for thoughtful talks and meaningful moments."],
    [SUPI,"…shows unprompted affection so I feel pursued and valued."],
    [PHLE,"…offers steady, dependable support without pressure."]
  ], val => {
      const k = codeToAffKey(val); const arr = answers.desiredTop2 || [];
      if(k && !arr.includes(k) && arr.length<2) arr.push(k);
      answers.desiredTop2 = arr; saveState(); next();
  });

  /* Inclusion (Social) */
  if(step===4) return renderSingleList(box, "In social settings, I usually…", [
    [SANG,"…start conversations and draw people in, enjoying being at the center."],
    [CHOL,"…organize or lead the group toward a goal."],
    [MEL,"…engage selectively, often preferring one-on-one over big groups."],
    [SUPI,"…help quietly, waiting for others to invite me in."],
    [PHLE,"…go with the flow, joining calmly without pushing for attention."]
  ], val => { answers.social["social1"]=val; saveState(); next(); });

  if(step===5) return renderSingleList(box, "I feel most comfortable in groups when…", [
    [SANG,"…I’m surrounded by people and actively invited to join the fun."],
    [CHOL,"…there’s a clear purpose or project, not just chatter."],
    [MEL,"…the group is small, familiar, or low-key."],
    [SUPI,"…others seek me out and make me feel included."],
    [PHLE,"…the setting is relaxed and pressure-free."]
  ], val => { answers.social["social2"]=val; saveState(); next(); });

  /* Control (Decision-Making) */
  if(step===6) return renderSingleList(box, "When decisions need to be made, I usually…", [
    [CHOL,"…step up confidently and set direction for others."],
    [SANG,"…help decide with energy and optimism, inviting collaboration."],
    [MEL,"…prefer to manage my own responsibilities, not others’."],
    [SUPI,"…defer to others, supporting instead of leading."],
    [PHLE,"…stay flexible, only stepping in if needed to keep peace."]
  ], val => { answers.decision["decision1"]=val; saveState(); next(); });

  if(step===7) return renderSingleList(box, "When others influence decisions that affect me, I prefer…", [
    [CHOL,"…to have the final say and resist being directed."],
    [SANG,"…to collaborate and welcome positive input."],
    [MEL,"…to be left to my own autonomy and self-direction."],
    [SUPI,"…to feel secure when others take the lead and guide me."],
    [PHLE,"…gentle guidance that keeps harmony without conflict."]
  ], val => { answers.decision["decision2"]=val; saveState(); next(); });

  /* Respect & Recognition */
  if(step===8) return renderSingleList(box, "I feel my opinions are respected in our relationship.", [
    [3,"Strongly Agree"],[2,"Agree"],[1,"Disagree"],[0,"Strongly Disagree"]
  ], val => { answers.rr.rr1 = Number(val); saveState(); next(); });

  if(step===9) return renderSingleList(box, "We are aligned on core values and honor our covenant.", [
    [3,"Strongly Agree"],[2,"Agree"],[1,"Disagree"],[0,"Strongly Disagree"]
  ], val => { answers.rr.rr2 = Number(val); saveState(); next(); });

  /* Connection tendencies (inputs used for comm-style inference) */
  if(step===10) return renderSingleList(box, "During conflict, I naturally…", [
    ["SteadyConnector","Look for a steady, low-tension path forward."],
    ["ReassuranceSeeker","Seek quick clarity and closeness right away."],
    ["IndependentConnector","Take a brief step back to collect my thoughts."],
    ["GuardedConnector","Share less until I feel fully safe to open up."]
  ], val => { answers.bond["bond1"]=val; saveState(); next(); });

  if(step===11) return renderSingleList(box, "When I feel unappreciated, I tend to…", [
    ["SteadyConnector","Keep things even and move forward steadily."],
    ["ReassuranceSeeker","Ask for clear acknowledgment or reassurance."],
    ["IndependentConnector","Pull back to reset and think it through."],
    ["GuardedConnector","Go quiet and wait before sharing more."]
  ], val => { answers.bond["bond2"]=val; saveState(); next(); });

  if(step===12) return renderSingleList(box, "After a disagreement, I prefer to…", [
    ["SteadyConnector","Reconnect calmly with a simple next step together."],
    ["ReassuranceSeeker","Repair together soon and name what’s okay between us."],
    ["IndependentConnector","Pause briefly, then return at a set time to resolve."],
    ["GuardedConnector","Start small—share a little, then build from there."]
  ], val => { answers.bond["bond3"]=val; saveState(); next(); });

  if(step===13) return renderSingleList(box, "When I’m overwhelmed, I prefer to…", [
    ["SteadyConnector","Keep routines steady and talk when emotions settle."],
    ["ReassuranceSeeker","Get reassurance and closeness before moving on."],
    ["IndependentConnector","Take protected space, then reconnect as planned."],
    ["GuardedConnector","Ease in gradually and share once trust feels solid."]
  ], val => { answers.bond["bond4"]=val; saveState(); finalize(); });
}
function next(){ step++; renderStep(); }

/* Step 0: Top/Next picker */
function renderTopNextPicker(root){
  ensureDefaults();
  const stage = (answers.top4.length < 4) ? 'top4' : (answers.next4.length < 4) ? 'next4' : 'done';
  if(stage === 'done'){
    const picked = [...answers.top4, ...answers.next4];
    const remaining = TYPES.filter(k => !picked.includes(k));
    answers.rank = picked.length ? [...picked, ...remaining] : [...TYPES];
    saveState(); next(); return;
  }
  const isTop = (stage==='top4');
  const pickedSet = new Set(isTop ? answers.top4 : answers.next4);
  const alreadyPicked = new Set([...answers.top4, ...answers.next4]);
  const pool = TYPES.filter(k => !alreadyPicked.has(k) || pickedSet.has(k));

  const heading = isTop ? "Choose 4 Connection Types" : "You're halfway there!";
  const guidanceTop = `<div class="intro-text" style="text-align:center;">
      <p>Think about a perfect day with your partner. What kinds of connection feel most meaningful to you?</p>
      <p>Choose the 4 connection types that matter most to you. Tap a card to select it.</p>
    </div>`;
  const guidanceNext = `<div class="intro-text" style="text-align:center;">
      <p>From the remaining options, choose the 4 connection types that come next in importance to you.</p>
    </div>`;

  root.innerHTML = `
    <h3 style="text-align:center;">${heading}</h3>
    <p class="rank-help" style="text-align:center; margin-top:6px; color:#4a607a;"><em>Selected: ${pickedSet.size} / 4</em></p>
    ${isTop ? guidanceTop : guidanceNext}
    <div class="mini-grid" id="miniGrid"></div>
  `;
  const grid = root.querySelector('#miniGrid');
  pool.forEach(key=>{
    const card = document.createElement('div');
    card.className = 'mini-card' + (pickedSet.has(key) ? ' selected' : '');
    card.style.borderLeft = `6px solid ${typeColors[key]}`;
    card.style.paddingLeft = '10px';
    const label = INTIMACY[key].label.replace(/Intimacy/gi, 'Connection');
    const desc  = INTIMACY[key].desc.replace(/intimacy/gi, 'connection');
    card.innerHTML = `<div class="mini-title">${label}</div><p class="mini-desc">${desc}</p>`;
    card.onclick = ()=>{
      if(pickedSet.has(key)) pickedSet.delete(key); else if(pickedSet.size<4) pickedSet.add(key);
      if(isTop) answers.top4=[...pickedSet]; else answers.next4=[...pickedSet];
      saveState(); (pickedSet.size===4) ? setTimeout(()=>renderTopNextPicker(root),120) : renderTopNextPicker(root);
    };
    grid.appendChild(card);
  });

  if (pool.length === 0) {
    const note = document.createElement('p'); note.className = 'muted'; note.textContent = 'All picked — advancing…';
    root.appendChild(note);
    setTimeout(()=> { answers.rank = [...TYPES]; saveState(); next(); }, 200);
  }
}

/* Single-choice (no spouse reminder) */
function renderSingleList(root, title, options, onPick){
  root.innerHTML = `
    <h3 style="text-align:center;">${title}</h3>
    <div class="vertical-list"></div>
  `;
  const v = root.querySelector('.vertical-list');
  options.forEach(([val, txt])=>{
    const b = document.createElement('button'); b.className = 'answer-btn'; b.textContent = txt; b.onclick = ()=> onPick(val); v.appendChild(b);
  });
}

/* Finalize & Results (resilient) */
function finalize(){
  ensureDefaults();
  let core = Array.isArray(answers.top4)&&answers.top4.length===4 ? [...answers.top4]  : [];
  let growth = Array.isArray(answers.next4)&&answers.next4.length===4 ? [...answers.next4] : [];
  if (core.length!==4 || growth.length!==4){ const r = Array.isArray(answers.rank)&&answers.rank.length===TYPES.length ? answers.rank.slice() : TYPES.slice(); core=r.slice(0,4); growth=r.slice(4,8); }
  const picked = new Set([...core, ...growth]);
  const untapped = TYPES.filter(k=>!picked.has(k));

  const socialCounts={E:0,S:0,R:0,A:0,U:0}; Object.values(answers.social).forEach(k=> socialCounts[k]++);
  const decisionCounts={E:0,S:0,R:0,A:0,U:0}; Object.values(answers.decision).forEach(k=> decisionCounts[k]++);
  const socialTop = Object.entries(socialCounts).sort((a,b)=>b[1]-a[1])[0]?.[0] || null;
  const decisionTop = Object.entries(decisionCounts).sort((a,b)=>b[1]-a[1])[0]?.[0] || null;

  const socialSummary = socialTop ? ({E:"You bring energy and enthusiasm to social settings.",S:"You give structure and help lead groups well.",R:"You prefer deep, thoughtful conversations.",A:"You value calm, low-key connection.",U:"You make sure others feel included and cared for."})[socialTop] : "You adapt flexibly to different situations.";
  const decisionSummary = decisionTop ? ({E:"You decide with enthusiasm, prioritizing enjoyment and momentum.",S:"You decide decisively, goal-first.",R:"You analyze carefully before choosing.",A:"You seek harmony and consensus.",U:"You steadily support plans and shared goals."})[decisionTop] : "You adapt flexibly to different situations.";

  const rrScore = (answers.rr.rr1 ?? 0) + (answers.rr.rr2 ?? 0);
  const rrLabel = rrScore>=5 ? "Strong" : rrScore>=3 ? "Moderate" : "Needs Attention";

  const bondCounts = {SteadyConnector:0, ReassuranceSeeker:0, IndependentConnector:0, GuardedConnector:0};
  Object.values(answers.bond).forEach(k=> bondCounts[k]++);
  const bondingKey = Object.entries(bondCounts).sort((a,b)=>b[1]-a[1])[0]?.[0] || "SteadyConnector";

  const profile = {
    name: yourName || "You",
    coreTypes: core, growthTypes: growth, untappedTypes: untapped,
    expressedTop2: [...(answers.expressedTop2||[])],
    desiredTop2:   [...(answers.desiredTop2||[])],
    socialTop, decisionTop, socialSummary, decisionSummary,
    rrScore, rrLabel, bondingKey
  };
  renderResults(profile);
}

/* ======= Baseline helpers used in results (kept) ======= */
function typesColumn(name, types){
  const safe = Array.isArray(types) && types.length ? types : TYPES.slice(0,4);
  return `<div class="partner-card"><div class="partner-inner">
      <div class="partner-header">${name || "Results"}</div>
      ${safe.map(k=>`<div class="result-block" style="border-left-color:${typeColors[k]}; background:${typeOpac[k]};">
          <strong>${INTIMACY[k].label}</strong> — ${INTIMACY[k].desc}
        </div>`).join("")}
    </div></div>`;
}
const affEXP = {
  Playful:"You naturally lift the mood with humor, lightness, and spontaneous moments that say, “I’m with you.” You turn ordinary spaces into warm, safe places.",
  Initiative:"You show love by stepping in and taking pressure off—solving problems, removing obstacles, and protecting what matters.",
  DeepTalk:"You invite depth—lingering in meaningful conversation, asking curious questions, and making others feel profoundly understood.",
  Warmth:"You offer steady presence and gentle affection. Your calming tone, touch, and attention help your spouse exhale and feel safe.",
  Support:"You love through action: pitching in, following through, and sharing the load. Your reliability says, “You’re not alone—I'm with you.”"
};
const affDES = {
  Playful:"You feel loved when things are kept light, playful, and hope-filled—like a breath of fresh air when life feels heavy.",
  Initiative:"You feel most cared for when your spouse takes initiative—removing stress, solving a problem, or leading with strength and protection.",
  DeepTalk:"You feel cherished when your spouse slows down, listens deeply, and engages your thoughts and heart with focused, meaningful time.",
  Warmth:"You feel secure with gentle presence, unhurried attention, and comforting touch that says, “I’m here, and you matter.”",
  Support:"You feel honored when your spouse helps practically—sharing responsibilities and showing up consistently in the daily things."
};
const temperamentDetails = {
  E:{ looks:"You energize the room and move things forward with enthusiasm.", watch:"Fast pace can out-run deeper needs or quieter voices.", tip:"Schedule both lively connection and quiet check-ins to stay balanced." },
  S:{ looks:"You provide direction, set goals, and protect progress.",       watch:"Decisiveness can feel controlling if not co-authored.", tip:"Invite input early and name where you’re flexible." },
  R:{ looks:"You think deeply, ask great questions, and value thoughtfulness.", watch:"Over-analysis can delay decisions or feel distant.", tip:"Time-box decisions and surface feelings—not just facts." },
  A:{ looks:"You bring calm, keep the peace, and reduce friction.",          watch:"Avoiding tension can postpone needed clarity.", tip:"Name one concrete next step even when keeping it gentle." },
  U:{ looks:"You serve steadily, include others, and build trust.",          watch:"Understating your needs can lead to quiet resentment.", tip:"Voice one specific need and one boundary you appreciate." }
};
function buildTemperamentText(topKey, summary){
  if(!topKey) return summary || "You flex based on the moment."; const d=temperamentDetails[topKey]||{};
  return `${summary || ""} <br><em>What it looks like:</em> ${d.looks || ""} <br><em>Watch-outs:</em> ${d.watch || ""} <br><em>Helpful tip:</em> ${d.tip || ""}`;
}
function temperamentAccentFromKey(k){
  const map = { E:{color:typeColors.Emotional,bg:typeOpac.Emotional}, S:{color:typeColors.Commitment,bg:typeOpac.Commitment}, R:{color:typeColors.Intellectual,bg:typeOpac.Intellectual}, A:{color:typeColors.Affable,bg:typeOpac.Affable}, U:{color:typeColors.Partnership,bg:typeOpac.Partnership} };
  return map[k] || { color:"#4D9DE0", bg:"rgba(77,157,224,.08)" };
}
function temperamentAccentFromAffKey(k){ const t = { Playful:"E", Initiative:"S", DeepTalk:"R", Warmth:"A", Support:"U" }[k]; return temperamentAccentFromKey(t); }
function temperamentBlock(name, title, text, topKey){
  const acc = temperamentAccentFromKey(topKey);
  return `<div class="result-block" style="border-left-color:${acc.color}; background:${acc.bg};"><strong>${name || "You"} — ${title}:</strong> <span>${text || "You flex based on the moment."}</span></div>`;
}
function rrAccent(label){
  if(label==="Strong")   return { color:typeColors.Partnership, bg:typeOpac.Partnership };
  if(label==="Moderate") return { color:typeColors.Commitment,  bg:typeOpac.Commitment  };
  return { color:typeColors.Emotional, bg:typeOpac.Emotional };
}
function rrStatement(score){
  if(score>=5) return "You generally feel affirmed, appreciated, respected, and validated—and you likely offer the same in return.";
  if(score>=3) return "You often feel appreciated and respected, though there may be moments when clearer affirmation would be meaningful.";
  return "You may not consistently feel affirmed or validated; be explicit about the kinds of appreciation that help you feel respected.";
}
function promptsBlock(items){
  return `
    <div class="prompt-block">
      <strong>Discussion Prompts</strong>
      <ul class="results-list" style="margin-top:6px;">
        ${items.map(li=>`<li>${li}</li>`).join("")}
      </ul>
    </div>
  `;
}

/* ==== Communication Style inference & cards (your v13k) ==== */
function inferCommunicationStyle(p){
  const bond = p.bondingKey || "SteadyConnector";
  const rr   = (typeof p.rrScore === 'number') ? p.rrScore : 0;
  const dec  = p.decisionTop || null;
  const soc  = p.socialTop   || null;

  if (bond === "IndependentConnector") return "Avoidant / Withdrawn";
  if (bond === "GuardedConnector")     return "Passive-Aggressive";
  if (bond === "ReassuranceSeeker") {
    if (dec === 'S' || rr <= 2) return "Aggressive";
    return "Assertive";
  }
  if (bond === "SteadyConnector") {
    if (rr >= 5 && dec !== 'S') return "Collaborative / Empathetic";
    if (dec === 'A' || soc === 'A' || soc === 'U') return "Passive";
    return "Collaborative / Empathetic";
  }
  return "Assertive";
}
function communicationStyleCard(style){
  const copy = {
    "Passive": `<div class="result-block" style="border-left-color:${typeColors.Affable}; background:${typeOpac.Affable};"><p><strong>Passive Communication</strong> — According to your assessment, you tend to use a passive communication style. This means you often avoid conflict and may find yourself going along with others to keep the peace. You might withhold your opinions and feelings to prevent disagreement, which can sometimes lead to resentment or emotional distance building up over time. The key is to find a way to express your needs and feelings without feeling like you're causing conflict.</p></div>`,
    "Aggressive": `<div class="result-block" style="border-left-color:${typeColors.Commitment}; background:${typeOpac.Commitment};"><p><strong>Aggressive Communication</strong> — Your results indicate a strong tendency toward an aggressive communication style. This approach is direct and forceful, and you may find yourself dominating conversations or interrupting others to push your own perspective. This style is often linked to a desire for control and can leave others feeling unheard or overpowered. The goal is to learn to express your needs powerfully while also creating space for others to share theirs.</p></div>`,
    "Passive-Aggressive": `<div class="result-block" style="border-left-color:${typeColors.Conflict}; background:${typeOpac.Conflict};"><p><strong>Passive-Aggressive Communication</strong> — Based on your assessment, you lean toward a passive-aggressive communication style. This can show up as sarcasm, giving the silent treatment, or making subtle jabs instead of being direct about what you need. This style can be especially damaging because it combines hostility with avoidance, leaving issues unresolved and creating frustration for everyone involved. A great next step is to practice being more direct and open in your conversations.</p></div>`,
    "Assertive": `<div class="result-block" style="border-left-color:${typeColors.Intellectual}; background:${typeOpac.Intellectual};"><p><strong>Assertive Communication</strong> — Congratulations! Your assessment shows you have a strong assertive communication style. This is considered the healthiest approach, as you are able to clearly and respectfully express your needs while also genuinely respecting the other person's perspective. This balanced style builds trust and intimacy because it blends honesty with empathy. Keep up the great work!</p></div>`,
    "Avoidant / Withdrawn": `<div class="result-block" style="border-left-color:${typeColors.Partnership}; background:${typeOpac.Partnership};"><p><strong>Avoidant / Withdrawn Communication</strong> — Your results suggest you often use an avoidant/withdrawn communication style. When things get difficult, you might find yourself shutting down, disengaging, or “stonewalling” during conversations. This style is common when people feel overwhelmed or are trying to avoid conflict entirely. It can prevent issues from being resolved and create emotional distance. Learning to stay present in difficult conversations is a great place to start.</p></div>`,
    "Collaborative / Empathetic": `<div class="result-block" style="border-left-color:${typeColors.Emotional}; background:${typeOpac.Emotional};"><p><strong>Collaborative / Empathetic Communication</strong> — Your assessment highlights a natural inclination toward a collaborative/empathetic communication style. This is a strengths-based approach where you actively listen, validate others' feelings, and work together to solve problems. It's very similar to assertive communication but has an even stronger focus on cooperation and understanding. This style helps build strong, intimate relationships.</p></div>`
  };
  return copy[style] || copy["Assertive"];
}
function communicationStrategyCard(style){
  const tip = {
    "Passive": `<div class="result-block" style="border-left-color:${typeColors.Affable}; background:${typeOpac.Affable};"><strong>Passive Communicator — Try this:</strong><p>Start by taking small steps to voice your opinions and needs. Instead of saying, “Whatever you want to do is fine,” try, “I’d actually prefer to go to the movies tonight—how does that sound to you?”</p></div>`,
    "Aggressive": `<div class="result-block" style="border-left-color:${typeColors.Commitment}; background:${typeOpac.Commitment};"><strong>Aggressive Communicator — Try this:</strong><p>Practice using “I” statements instead of “you” statements. For example, change “You always interrupt me” to “I feel unheard when I’m interrupted.” This shifts the focus from blame to personal experience.</p></div>`,
    "Passive-Aggressive": `<div class="result-block" style="border-left-color:${typeColors.Conflict}; background:${typeOpac.Conflict};"><strong>Passive-Aggressive Communicator — Try this:</strong><p>Be direct. When you feel frustrated, instead of making a sarcastic comment, try saying, “I’m feeling frustrated right now because of X.” This allows for an honest conversation rather than a hidden conflict.</p></div>`,
    "Assertive": `<div class="result-block" style="border-left-color:${typeColors.Intellectual}; background:${typeOpac.Intellectual};"><strong>Assertive Communicator — Keep strengthening:</strong><p>Pair clear “I” statements with reflective listening and one shared next step. Example: “I feel anxious about timing; what I’m hearing you say is you need more detail. Could we agree to a 10-minute plan after dinner?”</p></div>`,
    "Avoidant / Withdrawn": `<div class="result-block" style="border-left-color:${typeColors.Partnership}; background:${typeOpac.Partnership};"><strong>Avoidant/Withdrawn Communicator — Try this:</strong><p>Manage overwhelm by taking a short break with a clear return time: “I’m feeling overwhelmed right now. Can we talk in 15 minutes?” This is healthier than stonewalling and keeps connection safe.</p></div>`,
    "Collaborative / Empathetic": `<div class="result-block" style="border-left-color:${typeColors.Emotional}; background:${typeOpac.Emotional};"><strong>Collaborative/Empathetic Communicator — Keep strengthening:</strong><p>Continue validating (“That makes sense”), summarize shared goals, and end with a co-authored step: “So we both want calmer mornings—let’s test a 5-minute prep tonight.”</p></div>`
  };
  return tip[style] || tip["Assertive"];
}

/* ======= Merged Results Renderer (replaces original to include Connection Patterns and teaching copy) ======= */
function renderResults(p){
  hideAllPages();
  const resultPage=document.getElementById('resultPage'); resultPage.classList.remove('hidden');
  document.getElementById('resultsHeader').textContent = "Your Relational Connection Profile";
  const mount=document.getElementById('results'); mount.innerHTML=""; const container=document.createElement('div'); container.id="soloReport"; mount.appendChild(container);

  const addDivider=()=>{ const d=document.createElement('div'); d.className='section-divider'; container.appendChild(d); };
  const addSubDivider=()=>{ const d=document.createElement('div'); d.className='subsection-divider'; container.appendChild(d); };
  const addHTML=(html)=>{ const tmp=document.createElement('div'); tmp.innerHTML=html; while(tmp.firstChild) container.appendChild(tmp.firstChild); };
  const safe=(label,fn)=>{ try{ fn(); }catch(e){ console.error("Results render error @",label,e); addHTML(`<p class="muted">(Note) A section failed to load. Continuing…</p>`);} };

  /* Section 1 (unchanged headings) */
  safe("s1-head", ()=>{ addDivider(); addHTML(`
    <h3 class="section-title">Section 1: Your Intimacy Preferences</h3>
    <div class="intro-text">
      This section is about understanding intimacy—the profound experience of being truly known, deeply connected, and fully cherished. It reveals your unique profile, showing how you naturally express love and how you feel most loved in return.
      <p>Our model organizes intimacy into 12 types across human experience, combining the essential aspects of <em>“being together”</em> (like emotional bonding and spiritual connection) and <em>“doing together”</em> (like shared effort and practical unity). Think of these as a helpful map for your next steps.</p>
    </div>`); });

  safe("s1-core", ()=>{ addSubDivider(); addHTML(`
    <h4 class="subsection-title">Your Core Connection Strengths</h4>
    <div class="verse">“Above all, love each other deeply, because love covers over a multitude of sins.” — 1 Peter 4:8</div>
    <p class="intro-text">These are your most fulfilling and effortless pathways to deeper closeness.</p>`); addHTML(typesColumn(p.name,p.coreTypes)); addHTML(promptsBlock([
      "<em>Explore:</em> Why does each strength matter to you, and when do you feel most connected through it?",
      "<em>Be Creative:</em> Pick one practical way to use a strength intentionally this week.",
      "<em>Share:</em> Name a recent moment you felt especially connected through one of these types."
    ])); });

  safe("s1-growth-untapped", ()=>{ addSubDivider(); addHTML(`
    <h4 class="subsection-title">Your Areas for Growth</h4>
    <div class="verse">“Let us consider how we may spur one another on toward love and good deeds.” — Hebrews 10:24</div>
    <p class="intro-text">These are wonderful opportunities for intentional focus. With a bit of practice and presence, you can deepen connection here.</p>`); addHTML(typesColumn(p.name,p.growthTypes)); addHTML(promptsBlock([
      "<em>One small step:</em> Choose a 10-minute practice for one growth area.",
      "<em>Support plan:</em> What would help you show up here more consistently?"
    ]));
    addSubDivider(); addHTML(`
    <h4 class="subsection-title">Your Untapped Opportunities</h4>
    <div class="verse">“See, I am doing a new thing! … Do you not perceive it?” — Isaiah 43:19</div>
    <p class="intro-text">These aren’t weaknesses—think of them as exciting, untapped gifts to discover. Exploring them can add surprising depth and joy.</p>`); addHTML(typesColumn(p.name,p.untappedTypes)); addHTML(promptsBlock([
      "<em>Pick one:</em> Which untapped type feels most intriguing right now?",
      "<em>Try it:</em> Design a tiny experiment you can do this week.",
      "<em>Reflect:</em> What did you enjoy or learn?"
    ])); });

  /* Section 2 — Relational Dynamics (replacements + kept) */
  safe("s2-head", ()=>{ addDivider(); addHTML(`
    <h3 class="section-title">Section 2: Relational Dynamics</h3>
    <div class="intro-text">
      Your relationship isn't just a connection of two people; it's a unique dance of two beautiful, distinct individuals! This section is designed to help you understand the everyday rhythms that shape your connection. We'll explore how you naturally care for each other, how you engage socially, how you share influence and make decisions, and how you honor one another. Our hope is that these insights will not only bring clarity but also provide a powerful guide for your discussions, helping you protect your closeness and deepen your bond in every interaction.
    </div>`); });

  /* Compassion & Care — TEACHING VERSION */
  safe("s2-compassion", ()=>{ 
    addSubDivider(); 
    addHTML(`<h4 class="subsection-title">Compassion & Care</h4>`);
    addHTML(`<div class="framing-q">Do you care about me?</div>`);
    addHTML(`<div class="verse">“Be completely humble and gentle; be patient, bearing with one another in love.” — Ephesians 4:2</div>`);
    addHTML(`<p class="intro-text">Express Love and Feel Most Loved, according to your APS temperament in affection (expressed and wanted).</p>`);
    addHTML(compassionColumnTeaching(p));
    addHTML(promptsBlock([
      "<em>Spot the signal:</em> What specific action helps you feel most cared for this week?",
      "<em>Make it tiny:</em> Choose a 2–minute daily habit (text, touch, note, help).",
      "<em>Translate love:</em> How will you show care in your spouse’s preferred way?"
    ]));
  });

  /* Social Preferences — kept summary */
  safe("s2-social", ()=>{ 
    addSubDivider(); 
    addHTML(`<h4 class="subsection-title">Social Preferences</h4>`);
    addHTML(`<div class="framing-q">How do you recharge?</div>`);
    addHTML(`<div class="verse">“Therefore encourage one another and build each other up.” — 1 Thessalonians 5:11</div>`);
    addHTML(`<p class="intro-text">This dynamic is all about how you both recharge and engage with the world around you. It explores whether you feel energized by being with others (extraversion), find deep renewal in solitude (introversion), or perhaps thrive with a mix of both (ambiversion). Understanding these unique preferences is key to helping you and your spouse beautifully balance your needs for connection and personal space, ensuring you both feel filled up and ready to encourage each other daily.</p>`);
    addHTML(temperamentBlock(p.name,"Your Social Energy",buildTemperamentText(p.socialTop,p.socialSummary),p.socialTop));
    addHTML(promptsBlock([
      "<em>Recharge recipe:</em> What social setting fills your tank most reliably?",
      "<em>Plan 30 minutes:</em> Schedule one quick recharge moment this week.",
      "<em>Boundary:</em> Name one limit to prevent overwhelm or isolation."
    ]));
  });

  /* Power & Control — kept summary */
  safe("s2-power", ()=>{ 
    addSubDivider(); 
    addHTML(`<h4 class="subsection-title">Power & Control</h4>`);
    addHTML(`<div class="framing-q">Who gets to decide?</div>`);
    addHTML(`<div class="verse">“If any of you lacks wisdom, you should ask God … and it will be given to you.” — James 1:5</div>`);
    addHTML(`<p class="intro-text">This dynamic explores how you navigate decisions and leadership within your relationship, and how you approach influence and authority. It's all about how decisions are made, roles are shared, and influence is balanced. Understanding this helps you create a structure where shared responsibility and collaboration feel both respectful and safe. At its heart, this dynamic helps you to ensure the balance and mutual honor in your daily interactions.</p>`);
    addHTML(temperamentBlock(p.name,"Your Leadership Style",buildTemperamentText(p.decisionTop,p.decisionSummary),p.decisionTop));
    addHTML(promptsBlock([
      "<em>Co-author it:</em> Pick one decision to make together this week; define roles.",
      "<em>Invite input:</em> What’s one area you can ask for your spouse’s perspective earlier?",
      "<em>Flex or firm:</em> Name one value that’s firm and one area you’ll flex."
    ]));
  });

  /* Respect & Recognition — TEACHING VERSION */
  safe("s2-rr", ()=>{ 
    addSubDivider(); 
    addHTML(`<h4 class="subsection-title">Respect & Recognition</h4>`);
    addHTML(`<div class="framing-q">Do you value me?</div>`);
    addHTML(`<div class="verse">“Honor one another above yourselves.” — Romans 12:10</div>`);
    addHTML(rrCardTeaching(p));
    addHTML(promptsBlock([
      "<em>One appreciation:</em> Share one specific thing you value in your spouse today.",
      "<em>Daily rhythm:</em> Try naming one appreciation at the same time each day.",
      "<em>Alignment:</em> Name one core value you both share and how you’ll honor it this week."
    ]));
  });

  /* Section 3 — Connection Patterns (RESTORED) */
  safe("s3-connpatterns", ()=>{ 
    addDivider(); 
    addHTML(`<h3 class="section-title">Section 3: Connection Patterns</h3>
      <div class="verse">“Make every effort to keep the unity of the Spirit through the bond of peace.” — Ephesians 4:3</div>
      <p class="intro-text">Attachment-rooted patterns for how you reconnect after tension—recast in an engaging, conversational style.</p>`); 
    addHTML(patternColumnTeaching(p));
    addHTML(promptsBlock([
      "<em>Return time:</em> Agree on a clear pause-and-return window for hard talks.",
      "<em>Safety first:</em> Name one sentence that helps you both feel safe to share.",
      "<em>One small keep:</em> Choose a single “micro-trust” action to repeat daily."
    ]));
  });

  /* Section 4 — Communication Style (kept) */
  safe("s4-commstyle", ()=>{ 
    if (typeof inferCommunicationStyle==="function" && typeof communicationStyleCard==="function"){
      addDivider(); 
      const style = inferCommunicationStyle(p);
      addHTML(`<h3 class="section-title">Section 4: Communication Style</h3>`);
      addHTML(communicationStyleCard(style));
      addSubDivider();
      addHTML(`<h4 class="subsection-title">Moving from Conflict to Connection: Communication Style</h4>`);
      addHTML(communicationStrategyCard(style));
    }
  });

  /* Thank-you + PDF */
  safe("thanks", ()=>{ addDivider(); addHTML(`
    <div class="result-block" style="border-left-color:transparent; background:#fff;">
      <h3 class="thank-title">Thank You</h3>
      <div class="verse">“May the Lord make your love increase and overflow for each other and for everyone else, just as ours does for you.” — 1 Thessalonians 3:12</div>
      <p class="intro-text">We hope you enjoyed discovering your unique connection patterns. Use these insights as a friendly guide—not labels—to spark great conversations and small, consistent changes.</p>
      <p class="intro-text">To be truly known is to unlock the deepest intimacy—embrace what’s true today and aim courageously for what’s possible tomorrow.</p>
      <div style="text-align:center; margin-top:8px;"><button id="downloadPdfBtn" class="btn" style="max-width:260px;">Download PDF</button></div>
    </div>`); const pdfBtn=document.getElementById('downloadPdfBtn'); if(pdfBtn) pdfBtn.onclick=()=>window.print(); });

  clearState();
}

/* ========= SUPPORTING UTIL (R&R baseline) ========= */
function rrCard(p){
  const acc = rrAccent(p.rrLabel || "Moderate"); const score = Number.isFinite(p.rrScore) ? p.rrScore : 0;
  return `<div class="result-block" style="border-left-color:${acc.color}; background:${acc.bg};">
    <strong>${p.name || "You"} — Respect &amp; Recognition:</strong> ${p.rrLabel || "Moderate"} (${score}/6)
    <p style="margin:8px 0 0;">${rrStatement(score)}</p></div>`;
}
</script>
</body>
</html>