<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Discover Your Top Intimacy Needs</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #fff9f2;
      color: #1a3c5e;
      padding: 20px;
      max-width: 800px;
      margin: auto;
    }
    h1, h2 {
      text-align: center;
      color: #ff4d4d;
    }
    .branding {
      text-align: center;
      font-size: 0.85em;
      color: #888;
      margin-top: 20px;
    }
    .question {
      display: none;
    }
    .question.active {
      display: block;
    }
    .progress {
      text-align: center;
      margin: 20px 0;
      font-weight: bold;
    }
    label {
      display: block;
      margin: 10px 0;
      padding: 10px 15px;
      background-color: #f5f5f5;
      border-radius: 5px;
      cursor: pointer;
    }
    input[type="radio"] {
      margin-right: 10px;
    }
    button {
      background-color: #4d9de0;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 5px;
      cursor: pointer;
      display: block;
      margin: 20px auto;
    }
    #resultSection {
      display: none;
      margin-top: 30px;
    }
    canvas {
      display: block;
      margin: 30px auto;
      max-width: 100%;
    }
    .result-block, .description-block {
      background-color: #f0f4f9;
      border-left: 5px solid #4d9de0;
      padding: 15px;
      margin-bottom: 20px;
    }
    form#emailForm {
      margin-top: 30px;
      text-align: center;
    }
    form#emailForm input[type="email"] {
      padding: 10px;
      width: 80%;
      max-width: 300px;
      margin-bottom: 10px;
    }
    .model-header {
      font-size: 16px;
      text-align: center;
      margin-top: 30px;
      font-style: italic;
      color: #444;
    }
  </style>
</head>
<body>
  <h1>What Are Your Top Intimacy Needs?</h1>
  <div class="progress" id="progressText">Question 1 of 24</div>

  <form id="quizForm">
    <div id="quiz"></div>
    <button type="button" id="nextButton">Next</button>
  </form>
  <div class="branding">HappyMarriageHappyLife.com ©</div>

  <div id="resultSection">
    <h2>Your Personalized Intimacy Profile</h2>
    <div class="model-header">
      Your results are based on the Covenant Intimacy Fulfillment Model™ — a biblically rooted model of 12 intimacy types designed by Dr. Scott Inman.
    </div>
    <canvas id="resultsChart"></canvas>
    <div id="resultBreakdown"></div>
    <div id="descriptions"></div>

    <form id="emailForm" action="https://formspree.io/f/xgvzkwre" method="POST">
      <label>Want your results emailed to you?</label>
      <input type="email" name="email" placeholder="Enter your email" required>
      <input type="hidden" id="scoreSummary" name="message" value="">
      <button type="submit">Send Results</button>
    </form>

    <button onclick="downloadPDF()">Download PDF</button>
    <button onclick="location.reload()">Retake Quiz</button>
    <div class="branding">HappyMarriageHappyLife.com ©</div>
  </div>
  <script>
    const questions = [
      { q: "I feel most connected when we share spiritual beliefs or pray together.", type: "Spiritual" },
      { q: "I value deep emotional conversations where I feel fully heard and understood.", type: "Emotional" },
      { q: "Having respectful, honest communication—especially during conflict—is important to me.", type: "Conflict" },
      { q: "I enjoy growing intellectually together—learning, reading, or discussing ideas.", type: "Intellectual" },
      { q: "Being physically close (hugs, cuddles, kisses) helps me feel secure.", type: "Physical" },
      { q: "I feel loved when we share sexual closeness and intimacy.", type: "Sexual" },
      { q: "Having shared responsibilities and making decisions as a team matters to me.", type: "Partnership" },
      { q: "I feel safe and connected when we handle tough situations together, not apart.", type: "Conflict" },
      { q: "Spending quality, lighthearted time (laughing, relaxing, having fun) strengthens us.", type: "Affable" },
      { q: "Creating art, music, or other creative experiences together brings me joy.", type: "Creative" },
      { q: "When we manage money together responsibly and transparently, I feel connected.", type: "Financial" },
      { q: "Affectionate touch and presence (like holding hands or snuggling) is very meaningful.", type: "Physical" },
      { q: "I appreciate kind and thoughtful actions done without being asked.", type: "Affable" },
      { q: "Deep heart talks and mutual emotional vulnerability create strong closeness for me.", type: "Emotional" },
      { q: "I feel secure when we set goals together and make decisions as partners.", type: "Partnership" },
      { q: "Shared faith and a common spiritual direction unites us.", type: "Spiritual" },
      { q: "I need to feel sexually desired and enjoyed by my partner.", type: "Sexual" },
      { q: "Playful time, laughing, or even watching a show together helps me connect.", type: "Affable" },
      { q: "It’s important to me that we can talk respectfully even during arguments.", type: "Conflict" },
      { q: "Using money wisely and discussing purchases builds trust and closeness.", type: "Financial" },
      { q: "Collaborating on creative things or solving problems creatively makes me feel alive.", type: "Creative" },
      { q: "I love when we pray together, read Scripture, or serve with shared faith.", type: "Spiritual" },
      { q: "We grow closer when we talk about values, dreams, and big ideas.", type: "Intellectual" },
      { q: "Being emotionally safe and not judged lets me open my heart.", type: "Emotional" }
    ];

    const quizContainer = document.getElementById("quiz");
    const progressText = document.getElementById("progressText");
    let currentQuestion = 0;
    const scores = {};

    questions.forEach(q => {
      scores[q.type] = 0;
    });

    function showQuestion(index) {
      quizContainer.innerHTML = '';
      const question = questions[index];
      const div = document.createElement("div");
      div.className = "question active";
      div.innerHTML = `
        <h3>${question.q}</h3>
        <label><input type="radio" name="q${index}" value="5"> Strongly Agree</label>
        <label><input type="radio" name="q${index}" value="4"> Agree</label>
        <label><input type="radio" name="q${index}" value="3"> Neutral</label>
        <label><input type="radio" name="q${index}" value="2"> Disagree</label>
        <label><input type="radio" name="q${index}" value="1"> Strongly Disagree</label>
        <div class="branding">HappyMarriageHappyLife.com ©</div>
      `;
      quizContainer.appendChild(div);
      progressText.textContent = `Question ${index + 1} of ${questions.length}`;
    }

    document.getElementById("nextButton").addEventListener("click", () => {
      const selected = document.querySelector(`input[name="q${currentQuestion}"]:checked`);
      if (!selected) {
        alert("Please select an answer before continuing.");
        return;
      }
      const val = parseInt(selected.value);
      scores[questions[currentQuestion].type] += val;
      currentQuestion++;
      if (currentQuestion < questions.length) {
        showQuestion(currentQuestion);
      } else {
        document.getElementById("quizForm").style.display = "none";
        displayResults();
      }
    });

    window.onload = () => {
      showQuestion(currentQuestion);
    };
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const intimacyDescriptions = {
      Spiritual: "Shared faith and values form the foundation of your bond. When you grow together spiritually, you feel most united.",
      Emotional: "You long to feel emotionally safe and deeply known. Vulnerability, empathy, and meaningful conversations build your connection.",
      Intellectual: "You enjoy connecting through thoughtful conversations and shared learning. Stimulating one another mentally brings closeness.",
      Physical: "Being close through touch like cuddling or holding hands helps you feel safe and loved.",
      Sexual: "Sexual intimacy isn’t just physical—it's how you express affection, passion, and emotional closeness.",
      Conflict: "You value connection even during conflict. Healthy disagreement is an opportunity for deeper understanding, not disconnection.",
      Partnership: "You feel connected when you share responsibilities and make decisions as a united team.",
      Affable: "Playfulness, lightheartedness, and thoughtful service help you feel joyfully connected in everyday life.",
      Creative: "Sharing imagination, creative projects, or dreaming together inspires intimacy and delight.",
      Financial: "Trust and unity grow when finances are managed with transparency and shared goals.",
    };

    function displayResults() {
      const sorted = Object.entries(scores).sort((a, b) => b[1] - a[1]);
      const top4 = sorted.slice(0, 4);
      const mid4 = sorted.slice(4, 8);
      const low4 = sorted.slice(8, 12);

      document.getElementById("results").style.display = "block";

      document.getElementById("top4").innerHTML = top4.map(([type]) => `
        <li><strong>${type}:</strong> ${intimacyDescriptions[type]}</li>
      `).join('');

      document.getElementById("middle4").innerHTML = mid4.map(([type]) => `
        <li>${type}</li>
      `).join('');

      document.getElementById("bottom4").innerHTML = low4.map(([type]) => `
        <li>${type}</li>
      `).join('');

      renderChart(sorted);

      // Save for PDF
      window.finalResults = { top4, mid4, low4, sorted };
    }

    function renderChart(sorted) {
      const ctx = document.getElementById("chart").getContext("2d");
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: sorted.map(([t]) => t),
          datasets: [{
            label: 'Intimacy Score',
            data: sorted.map(([_, v]) => v),
            backgroundColor: [
              '#FF4D4D', '#4D9DE0', '#1A3C5E', '#FDC57B',
              '#92C9D6', '#F67599', '#D07E5F', '#A1B56C',
              '#C084FC', '#7BC1D1', '#BAA0F5', '#FFE07B'
            ]
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: { beginAtZero: true, max: 120 }
          }
        }
      });
    }

    async function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF();
      const logo = document.getElementById("logo");

      pdf.setFont("helvetica", "bold");
      pdf.setFontSize(16);
      pdf.text("Covenant Intimacy Fulfillment Model™", 15, 20);
      pdf.setFont("helvetica", "normal");
      pdf.setFontSize(12);
      pdf.text("Your results are based on the CIFM™ — a biblically rooted model of 12 intimacy types designed by Dr. Scott Inman.", 15, 30);

      let y = 45;
      pdf.setFont("helvetica", "bold");
      pdf.text("Top 4 Intimacy Types", 15, y);
      pdf.setFont("helvetica", "normal");
      y += 8;
      window.finalResults.top4.forEach(([type]) => {
        pdf.text(`• ${type}: ${intimacyDescriptions[type]}`, 15, y);
        y += 10;
      });

      y += 5;
      pdf.setFont("helvetica", "bold");
      pdf.text("Moderately Desired Intimacy Types", 15, y);
      y += 8;
      pdf.setFont("helvetica", "normal");
      window.finalResults.mid4.forEach(([type]) => {
        pdf.text(`• ${type}`, 15, y);
        y += 8;
      });

      y += 5;
      pdf.setFont("helvetica", "bold");
      pdf.text("Maintenance Areas", 15, y);
      y += 8;
      pdf.setFont("helvetica", "normal");
      window.finalResults.low4.forEach(([type]) => {
        pdf.text(`• ${type}`, 15, y);
        y += 8;
      });

      y += 10;
      pdf.setFont("helvetica", "italic");
      pdf.setFontSize(11);
      pdf.text("For more, read 'The House That Intimacy Built' — a free excerpt from Happy Marriage, Happy Life.", 15, y);

      pdf.save("Your_Intimacy_Profile.pdf");
    }
  </script>

  <div id="results" style="display:none; margin: 40px;">
    <h2>Covenant Intimacy Fulfillment Model™</h2>
    <p><em>Your results are based on the CIFM™ — a biblically rooted model of 12 intimacy types designed by Dr. Scott Inman.</em></p>

    <h3>Top 4 Intimacy Types</h3>
    <p>Your scores reflect a strong need for connection in these areas. When you and your spouse align in these types, your intimacy deepens significantly.</p>
    <ul id="top4"></ul>

    <h3>Moderately Desired Intimacy Types</h3>
    <p>You desire connection here at a moderate level. Nurturing these areas strengthens emotional balance in your relationship.</p>
    <ul id="middle4"></ul>

    <h3>Maintenance Areas</h3>
    <p>These scored lowest, which may indicate lower awareness or value. They may still impact your connection and deserve healthy maintenance.</p>
    <ul id="bottom4"></ul>

    <canvas id="chart" width="400" height="200" style="margin-top:20px;"></canvas>

    <div style="margin-top: 30px;">
      <button onclick="downloadPDF()">📄 Download My Results as PDF</button>
    </div>

    <form
      action="https://formspree.io/f/xgvzkwre"
      method="POST"
      style="margin-top: 30px;"
    >
      <label>Your Email to Receive Your Results:</label><br>
      <input type="email" name="email" required style="width:300px; padding:8px;"><br>
      <input type="hidden" name="message" value="Your CIFM quiz results and PDF will be sent shortly.">
      <button type="submit" style="margin-top:10px;">📧 Email My Results</button>
    </form>
  </div>
</body>
</html>
